2021-11-11 17:46:35.699652 (MainThread): Running with dbt=0.21.0
2021-11-11 17:46:35.761823 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 17:46:35.762702 (MainThread): Tracking: tracking
2021-11-11 17:46:35.787618 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728ddd6370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c2e7df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c2e77c0>]}
2021-11-11 17:46:35.799073 (MainThread): Partial parsing not enabled
2021-11-11 17:46:35.807582 (MainThread): Parsing macros/adapters.sql
2021-11-11 17:46:35.850387 (MainThread): Parsing macros/relations.sql
2021-11-11 17:46:35.851846 (MainThread): Parsing macros/catalog.sql
2021-11-11 17:46:35.854202 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 17:46:35.856260 (MainThread): Parsing macros/core.sql
2021-11-11 17:46:35.859841 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 17:46:35.861316 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 17:46:35.863934 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 17:46:35.865577 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 17:46:35.867033 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 17:46:35.924924 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 17:46:35.932011 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 17:46:35.942790 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 17:46:35.968356 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 17:46:35.973406 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 17:46:35.981045 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 17:46:35.983173 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 17:46:36.016717 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 17:46:36.035090 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 17:46:36.049668 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 17:46:36.060999 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 17:46:36.079153 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 17:46:36.099716 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 17:46:36.101590 (MainThread): Parsing macros/etc/query.sql
2021-11-11 17:46:36.102647 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 17:46:36.111021 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 17:46:36.112751 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 17:46:36.114392 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 17:46:36.115952 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 17:46:36.117765 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 17:46:36.289481 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:46:36.354060 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:46:36.356201 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:46:36.358167 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:46:36.360096 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:46:36.360534 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 17:46:36.360764 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 17:46:36.360963 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_second_dbt_model_id.57a0f8c493' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 17:46:36.361155 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_second_dbt_model_id.151b76d778' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 17:46:36.370357 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 17:46:36.375754 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec12fc0e-9e95-4b04-a44e-0a81a9b769d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7291654880>]}
2021-11-11 17:46:36.380419 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 17:46:36.384361 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec12fc0e-9e95-4b04-a44e-0a81a9b769d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c2154f0>]}
2021-11-11 17:46:36.384750 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 17:46:36.386274 (MainThread): 
2021-11-11 17:46:36.386703 (MainThread): Acquiring new postgres connection "master".
2021-11-11 17:46:36.387542 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 17:46:36.397557 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 17:46:36.397809 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 17:46:36.398009 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 17:46:36.402607 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 17:46:36.404017 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 17:46:36.405201 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 17:46:36.410900 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 17:46:36.411112 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 17:46:36.411291 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 17:46:36.414430 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:46:36.414721 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 17:46:36.414909 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 17:46:36.418105 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 17:46:36.419423 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 17:46:36.419882 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 17:46:36.423907 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.424119 (MainThread): On master: BEGIN
2021-11-11 17:46:36.424290 (MainThread): Opening a new connection, currently in state init
2021-11-11 17:46:36.427669 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:46:36.427912 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.428102 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 17:46:36.437505 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2021-11-11 17:46:36.438855 (MainThread): On master: ROLLBACK
2021-11-11 17:46:36.439346 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.439548 (MainThread): On master: BEGIN
2021-11-11 17:46:36.440178 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:46:36.440403 (MainThread): On master: COMMIT
2021-11-11 17:46:36.440586 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.440749 (MainThread): On master: COMMIT
2021-11-11 17:46:36.441193 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 17:46:36.441426 (MainThread): On master: Close
2021-11-11 17:46:36.442017 (MainThread): 18:46:36 | Concurrency: 2 threads (target='dev')
2021-11-11 17:46:36.442317 (MainThread): 18:46:36 | 
2021-11-11 17:46:36.444560 (Thread-1): Began running node model.IBA_challenge.num_installations
2021-11-11 17:46:36.444944 (Thread-1): 18:46:36 | 1 of 1 START view model public.num_installations..................... [RUN]
2021-11-11 17:46:36.445359 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:46:36.445566 (Thread-1): Compiling model.IBA_challenge.num_installations
2021-11-11 17:46:36.446779 (Thread-1): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 17:46:36.447267 (Thread-1): finished collecting timing info
2021-11-11 17:46:36.472982 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 17:46:36.473804 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:46:36.474197 (Thread-1): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 17:46:36.474510 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 17:46:36.477836 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:46:36.478109 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:46:36.478291 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

SELECT
    EXTRACT(year FROM installation_date) "Year",
    EXTRACT(month FROM installation_date) "Month",
    count(*)
FROM
    installation
GROUP BY
    EXTRACT(year FROM installation_date),
    EXTRACT(month FROM installation_date)
ORDER BY
    1,
    2;
  );

2021-11-11 17:46:36.478810 (Thread-1): Postgres error: syntax error at or near ";"
LINE 18:     2;
              ^

2021-11-11 17:46:36.479019 (Thread-1): On model.IBA_challenge.num_installations: ROLLBACK
2021-11-11 17:46:36.479457 (Thread-1): finished collecting timing info
2021-11-11 17:46:36.479724 (Thread-1): On model.IBA_challenge.num_installations: Close
2021-11-11 17:46:36.480159 (Thread-1): Database Error in model num_installations (models/monthly_num_installations.sql)
  syntax error at or near ";"
  LINE 18:     2;
                ^
  compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ";"
LINE 18:     2;
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model num_installations (models/monthly_num_installations.sql)
  syntax error at or near ";"
  LINE 18:     2;
                ^
  compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
2021-11-11 17:46:36.481851 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec12fc0e-9e95-4b04-a44e-0a81a9b769d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728b996d90>]}
2021-11-11 17:46:36.482287 (Thread-1): 18:46:36 | 1 of 1 ERROR creating view model public.num_installations............ [ERROR in 0.04s]
2021-11-11 17:46:36.482509 (Thread-1): Finished running node model.IBA_challenge.num_installations
2021-11-11 17:46:36.483606 (MainThread): Acquiring new postgres connection "master".
2021-11-11 17:46:36.483827 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.483999 (MainThread): On master: BEGIN
2021-11-11 17:46:36.484168 (MainThread): Opening a new connection, currently in state closed
2021-11-11 17:46:36.487513 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:46:36.487764 (MainThread): On master: COMMIT
2021-11-11 17:46:36.487943 (MainThread): Using postgres connection "master".
2021-11-11 17:46:36.488111 (MainThread): On master: COMMIT
2021-11-11 17:46:36.488427 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 17:46:36.488638 (MainThread): On master: Close
2021-11-11 17:46:36.489044 (MainThread): 18:46:36 | 
2021-11-11 17:46:36.489264 (MainThread): 18:46:36 | Finished running 1 view model in 0.10s.
2021-11-11 17:46:36.489506 (MainThread): Connection 'master' was properly closed.
2021-11-11 17:46:36.489669 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 17:46:36.494031 (MainThread): 
2021-11-11 17:46:36.494264 (MainThread): Completed with 1 error and 0 warnings:
2021-11-11 17:46:36.494463 (MainThread): 
2021-11-11 17:46:36.494655 (MainThread): Database Error in model num_installations (models/monthly_num_installations.sql)
2021-11-11 17:46:36.494836 (MainThread):   syntax error at or near ";"
2021-11-11 17:46:36.495010 (MainThread):   LINE 18:     2;
2021-11-11 17:46:36.495217 (MainThread):                 ^
2021-11-11 17:46:36.495408 (MainThread):   compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
2021-11-11 17:46:36.495590 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2021-11-11 17:46:36.495838 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c23de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c36a640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f728c36a610>]}
2021-11-11 17:46:36.496114 (MainThread): Flushing usage events
2021-11-11 17:47:22.256230 (MainThread): Running with dbt=0.21.0
2021-11-11 17:47:22.317293 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 17:47:22.318017 (MainThread): Tracking: tracking
2021-11-11 17:47:22.340867 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f837a7722e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378c87df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378c87dc0>]}
2021-11-11 17:47:22.351239 (MainThread): Partial parsing not enabled
2021-11-11 17:47:22.358902 (MainThread): Parsing macros/adapters.sql
2021-11-11 17:47:22.381586 (MainThread): Parsing macros/relations.sql
2021-11-11 17:47:22.382932 (MainThread): Parsing macros/catalog.sql
2021-11-11 17:47:22.385056 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 17:47:22.386687 (MainThread): Parsing macros/core.sql
2021-11-11 17:47:22.390244 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 17:47:22.391611 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 17:47:22.393795 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 17:47:22.395425 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 17:47:22.396765 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 17:47:22.448912 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 17:47:22.455331 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 17:47:22.464750 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 17:47:22.486524 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 17:47:22.490274 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 17:47:22.497029 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 17:47:22.498671 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 17:47:22.527788 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 17:47:22.544845 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 17:47:22.558104 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 17:47:22.565048 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 17:47:22.574644 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 17:47:22.593046 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 17:47:22.594754 (MainThread): Parsing macros/etc/query.sql
2021-11-11 17:47:22.595715 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 17:47:22.603834 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 17:47:22.605397 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 17:47:22.606857 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 17:47:22.608309 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 17:47:22.610049 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 17:47:22.778654 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.844749 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:47:22.846932 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:47:22.848888 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:47:22.850819 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 17:47:22.851259 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 17:47:22.851486 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 17:47:22.851684 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_second_dbt_model_id.57a0f8c493' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 17:47:22.851875 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_second_dbt_model_id.151b76d778' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 17:47:22.861089 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 17:47:22.866573 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e5edc6b2-6dea-4de6-872a-f26933a4aa33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378c70670>]}
2021-11-11 17:47:22.871315 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 17:47:22.871668 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e5edc6b2-6dea-4de6-872a-f26933a4aa33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378c70160>]}
2021-11-11 17:47:22.871959 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 17:47:22.873140 (MainThread): 
2021-11-11 17:47:22.873525 (MainThread): Acquiring new postgres connection "master".
2021-11-11 17:47:22.874349 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 17:47:22.884724 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 17:47:22.884979 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 17:47:22.885161 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 17:47:22.889299 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 17:47:22.890704 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 17:47:22.891818 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 17:47:22.897557 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 17:47:22.897794 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 17:47:22.897972 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 17:47:22.901191 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:47:22.901441 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 17:47:22.901634 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 17:47:22.904631 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 17:47:22.905975 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 17:47:22.906370 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 17:47:22.910429 (MainThread): Using postgres connection "master".
2021-11-11 17:47:22.910643 (MainThread): On master: BEGIN
2021-11-11 17:47:22.910821 (MainThread): Opening a new connection, currently in state init
2021-11-11 17:47:22.914447 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:47:22.914880 (MainThread): Using postgres connection "master".
2021-11-11 17:47:22.915077 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 17:47:22.925163 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2021-11-11 17:47:22.926510 (MainThread): On master: ROLLBACK
2021-11-11 17:47:22.926961 (MainThread): Using postgres connection "master".
2021-11-11 17:47:22.927150 (MainThread): On master: BEGIN
2021-11-11 17:47:22.927735 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:47:22.927945 (MainThread): On master: COMMIT
2021-11-11 17:47:22.928172 (MainThread): Using postgres connection "master".
2021-11-11 17:47:22.928339 (MainThread): On master: COMMIT
2021-11-11 17:47:22.928739 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 17:47:22.928952 (MainThread): On master: Close
2021-11-11 17:47:22.929370 (MainThread): 18:47:22 | Concurrency: 2 threads (target='dev')
2021-11-11 17:47:22.929601 (MainThread): 18:47:22 | 
2021-11-11 17:47:22.931802 (Thread-1): Began running node model.IBA_challenge.num_installations
2021-11-11 17:47:22.932168 (Thread-1): 18:47:22 | 1 of 1 START view model public.num_installations..................... [RUN]
2021-11-11 17:47:22.932543 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.932750 (Thread-1): Compiling model.IBA_challenge.num_installations
2021-11-11 17:47:22.934104 (Thread-1): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 17:47:22.934530 (Thread-1): finished collecting timing info
2021-11-11 17:47:22.959392 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 17:47:22.959870 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.960077 (Thread-1): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 17:47:22.960269 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 17:47:22.963462 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:47:22.963731 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.963911 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

SELECT
    EXTRACT(year FROM installation_date) "Year",
    EXTRACT(month FROM installation_date) "Month",
    count(*)
FROM
    installation
GROUP BY
    EXTRACT(year FROM installation_date),
    EXTRACT(month FROM installation_date)
ORDER BY
    1,
    2
  );

2021-11-11 17:47:22.970039 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 17:47:22.976471 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.976731 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 17:47:22.977437 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 17:47:22.984171 (Thread-1): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 17:47:22.984533 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.984939 (Thread-1): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 17:47:22.987480 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 17:47:22.992612 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 17:47:22.992858 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 17:47:22.993415 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 17:47:22.994665 (Thread-1): finished collecting timing info
2021-11-11 17:47:22.994914 (Thread-1): On model.IBA_challenge.num_installations: Close
2021-11-11 17:47:22.995425 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5edc6b2-6dea-4de6-872a-f26933a4aa33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378340fd0>]}
2021-11-11 17:47:22.995888 (Thread-1): 18:47:22 | 1 of 1 OK created view model public.num_installations................ [CREATE VIEW in 0.06s]
2021-11-11 17:47:22.996116 (Thread-1): Finished running node model.IBA_challenge.num_installations
2021-11-11 17:47:22.997251 (MainThread): Acquiring new postgres connection "master".
2021-11-11 17:47:22.997503 (MainThread): Using postgres connection "master".
2021-11-11 17:47:22.997678 (MainThread): On master: BEGIN
2021-11-11 17:47:22.997864 (MainThread): Opening a new connection, currently in state closed
2021-11-11 17:47:23.001124 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 17:47:23.001413 (MainThread): On master: COMMIT
2021-11-11 17:47:23.001601 (MainThread): Using postgres connection "master".
2021-11-11 17:47:23.001791 (MainThread): On master: COMMIT
2021-11-11 17:47:23.002114 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 17:47:23.002319 (MainThread): On master: Close
2021-11-11 17:47:23.002728 (MainThread): 18:47:23 | 
2021-11-11 17:47:23.002943 (MainThread): 18:47:23 | Finished running 1 view model in 0.13s.
2021-11-11 17:47:23.003167 (MainThread): Connection 'master' was properly closed.
2021-11-11 17:47:23.003349 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 17:47:23.008971 (MainThread): 
2021-11-11 17:47:23.009235 (MainThread): Completed successfully
2021-11-11 17:47:23.009452 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-11-11 17:47:23.009734 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8378368340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83783685b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83783684f0>]}
2021-11-11 17:47:23.010025 (MainThread): Flushing usage events
2021-11-11 18:08:17.874536 (MainThread): Running with dbt=0.21.0
2021-11-11 18:08:17.936122 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:08:17.936984 (MainThread): Tracking: tracking
2021-11-11 18:08:17.962359 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb885b3820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86ac8e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86ac8e50>]}
2021-11-11 18:08:17.973005 (MainThread): Partial parsing not enabled
2021-11-11 18:08:17.981146 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:08:18.004426 (MainThread): Parsing macros/relations.sql
2021-11-11 18:08:18.005828 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:08:18.008038 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:08:18.009725 (MainThread): Parsing macros/core.sql
2021-11-11 18:08:18.013384 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:08:18.014837 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:08:18.017029 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:08:18.018661 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:08:18.020040 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:08:18.073454 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:08:18.080093 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:08:18.089690 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:08:18.111904 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:08:18.115752 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:08:18.122659 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:08:18.124309 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:08:18.154011 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:08:18.170791 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:08:18.184403 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:08:18.191525 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:08:18.201292 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:08:18.219844 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:08:18.221552 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:08:18.222516 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:08:18.230613 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:08:18.232171 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:08:18.233628 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:08:18.235100 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:08:18.236847 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:08:18.406249 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:08:18.417446 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:08:18.475163 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:08:18.477344 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:08:18.479301 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:08:18.481246 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:08:18.481687 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 18:08:18.481927 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 18:08:18.482130 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_second_dbt_model_id.57a0f8c493' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 18:08:18.482324 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_second_dbt_model_id.151b76d778' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 18:08:18.491576 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:08:18.497065 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '037bb688-8117-4274-a686-68b457c3e5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86b08bb0>]}
2021-11-11 18:08:18.501733 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:08:18.502105 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '037bb688-8117-4274-a686-68b457c3e5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86a2bd00>]}
2021-11-11 18:08:18.502405 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:08:18.503626 (MainThread): 
2021-11-11 18:08:18.503994 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:08:18.504857 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:08:18.515353 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:08:18.515629 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:08:18.515825 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:08:18.530484 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 18:08:18.534530 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:08:18.537753 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:08:18.548113 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:08:18.548340 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:08:18.548512 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:08:18.552224 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.552539 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:08:18.552717 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:08:18.555923 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:08:18.557335 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:08:18.557759 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:08:18.562021 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.562243 (MainThread): On master: BEGIN
2021-11-11 18:08:18.562415 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:08:18.565533 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.565883 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.566084 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:08:18.578578 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:08:18.579958 (MainThread): On master: ROLLBACK
2021-11-11 18:08:18.580448 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.580635 (MainThread): On master: BEGIN
2021-11-11 18:08:18.581315 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.581575 (MainThread): On master: COMMIT
2021-11-11 18:08:18.581803 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.581969 (MainThread): On master: COMMIT
2021-11-11 18:08:18.582363 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:08:18.582573 (MainThread): On master: Close
2021-11-11 18:08:18.582968 (MainThread): 19:08:18 | Concurrency: 2 threads (target='dev')
2021-11-11 18:08:18.583184 (MainThread): 19:08:18 | 
2021-11-11 18:08:18.585527 (Thread-1): Began running node model.IBA_challenge.num_installations
2021-11-11 18:08:18.585903 (Thread-1): 19:08:18 | 1 of 2 START view model public.num_installations..................... [RUN]
2021-11-11 18:08:18.586139 (Thread-2): Began running node model.IBA_challenge.product_category
2021-11-11 18:08:18.586443 (Thread-2): 19:08:18 | 2 of 2 START view model public.product_category...................... [RUN]
2021-11-11 18:08:18.586877 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:08:18.587209 (Thread-1): Compiling model.IBA_challenge.num_installations
2021-11-11 18:08:18.587654 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:08:18.589208 (Thread-1): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:08:18.589463 (Thread-2): Compiling model.IBA_challenge.product_category
2021-11-11 18:08:18.591291 (Thread-2): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:08:18.591692 (Thread-1): finished collecting timing info
2021-11-11 18:08:18.597088 (Thread-2): finished collecting timing info
2021-11-11 18:08:18.634442 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:08:18.635153 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:08:18.635715 (Thread-2): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:08:18.635901 (Thread-2): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:08:18.636076 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:08:18.636435 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:08:18.636669 (Thread-1): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:08:18.636847 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:08:18.639492 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.639799 (Thread-2): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:08:18.640008 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.640263 (Thread-2): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues,
--and which region of the world is our best market.
  );

2021-11-11 18:08:18.640473 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:08:18.640762 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:08:18.641075 (Thread-2): Postgres error: syntax error at or near ")"
LINE 6:   );
          ^

2021-11-11 18:08:18.641316 (Thread-2): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:08:18.641593 (Thread-1): Postgres error: syntax error at or near "num_installations"
LINE 7: num_installations as (
        ^

2021-11-11 18:08:18.641857 (Thread-1): On model.IBA_challenge.num_installations: ROLLBACK
2021-11-11 18:08:18.642138 (Thread-2): finished collecting timing info
2021-11-11 18:08:18.642546 (Thread-2): On model.IBA_challenge.product_category: Close
2021-11-11 18:08:18.642973 (Thread-1): finished collecting timing info
2021-11-11 18:08:18.643849 (Thread-1): On model.IBA_challenge.num_installations: Close
2021-11-11 18:08:18.644524 (Thread-1): Database Error in model num_installations (models/monthly_num_installations.sql)
  syntax error at or near "num_installations"
  LINE 7: num_installations as (
          ^
  compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "num_installations"
LINE 7: num_installations as (
        ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model num_installations (models/monthly_num_installations.sql)
  syntax error at or near "num_installations"
  LINE 7: num_installations as (
          ^
  compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
2021-11-11 18:08:18.647176 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '037bb688-8117-4274-a686-68b457c3e5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb861819d0>]}
2021-11-11 18:08:18.643388 (Thread-2): Database Error in model product_category (models/product_category.sql)
  syntax error at or near ")"
  LINE 6:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 6:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  syntax error at or near ")"
  LINE 6:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:08:18.647870 (Thread-1): 19:08:18 | 1 of 2 ERROR creating view model public.num_installations............ [ERROR in 0.06s]
2021-11-11 18:08:18.648164 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '037bb688-8117-4274-a686-68b457c3e5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86a54340>]}
2021-11-11 18:08:18.648503 (Thread-1): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:08:18.648894 (Thread-2): 19:08:18 | 2 of 2 ERROR creating view model public.product_category............. [ERROR in 0.06s]
2021-11-11 18:08:18.649314 (Thread-2): Finished running node model.IBA_challenge.product_category
2021-11-11 18:08:18.650426 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:08:18.650752 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.650940 (MainThread): On master: BEGIN
2021-11-11 18:08:18.651177 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:08:18.654564 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:08:18.654872 (MainThread): On master: COMMIT
2021-11-11 18:08:18.655049 (MainThread): Using postgres connection "master".
2021-11-11 18:08:18.655211 (MainThread): On master: COMMIT
2021-11-11 18:08:18.655577 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:08:18.655811 (MainThread): On master: Close
2021-11-11 18:08:18.656254 (MainThread): 19:08:18 | 
2021-11-11 18:08:18.656493 (MainThread): 19:08:18 | Finished running 2 view models in 0.15s.
2021-11-11 18:08:18.656686 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:08:18.656847 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:08:18.657003 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:08:18.661837 (MainThread): 
2021-11-11 18:08:18.662091 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:08:18.662289 (MainThread): 
2021-11-11 18:08:18.662478 (MainThread): Database Error in model num_installations (models/monthly_num_installations.sql)
2021-11-11 18:08:18.662657 (MainThread):   syntax error at or near "num_installations"
2021-11-11 18:08:18.662826 (MainThread):   LINE 7: num_installations as (
2021-11-11 18:08:18.662993 (MainThread):           ^
2021-11-11 18:08:18.663158 (MainThread):   compiled SQL at target/run/IBA_challenge/models/monthly_num_installations.sql
2021-11-11 18:08:18.663330 (MainThread): 
2021-11-11 18:08:18.663509 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:08:18.663684 (MainThread):   syntax error at or near ")"
2021-11-11 18:08:18.663850 (MainThread):   LINE 6:   );
2021-11-11 18:08:18.664014 (MainThread):             ^
2021-11-11 18:08:18.664176 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:08:18.664349 (MainThread): 
Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
2021-11-11 18:08:18.664587 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86abd2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86abd520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcb86abdac0>]}
2021-11-11 18:08:18.664853 (MainThread): Flushing usage events
2021-11-11 18:09:19.252540 (MainThread): Running with dbt=0.21.0
2021-11-11 18:09:19.314042 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:09:19.314750 (MainThread): Tracking: tracking
2021-11-11 18:09:19.337839 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7086ed0580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70853e5df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70853e5dc0>]}
2021-11-11 18:09:19.348147 (MainThread): Partial parsing not enabled
2021-11-11 18:09:19.355981 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:09:19.378814 (MainThread): Parsing macros/relations.sql
2021-11-11 18:09:19.380154 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:09:19.382293 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:09:19.383911 (MainThread): Parsing macros/core.sql
2021-11-11 18:09:19.387442 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:09:19.388803 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:09:19.390986 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:09:19.392612 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:09:19.393962 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:09:19.446556 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:09:19.452990 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:09:19.462438 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:09:19.484367 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:09:19.488143 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:09:19.494924 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:09:19.496587 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:09:19.526029 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:09:19.542595 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:09:19.555919 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:09:19.562857 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:09:19.572446 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:09:19.590925 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:09:19.592632 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:09:19.593599 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:09:19.601701 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:09:19.603268 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:09:19.604745 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:09:19.606230 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:09:19.607970 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:09:19.778063 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.789165 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:09:19.845769 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:09:19.848257 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:09:19.850193 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:09:19.852094 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2021-11-11 18:09:19.852530 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_first_dbt_model_id.16e066b321' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 18:09:19.852762 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_first_dbt_model_id.5fb22c2710' (models/example/schema.yml) depends on a node named 'my_first_dbt_model' which was not found
2021-11-11 18:09:19.852963 (MainThread): [WARNING]: Test 'test.IBA_challenge.unique_my_second_dbt_model_id.57a0f8c493' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 18:09:19.853158 (MainThread): [WARNING]: Test 'test.IBA_challenge.not_null_my_second_dbt_model_id.151b76d778' (models/example/schema.yml) depends on a node named 'my_second_dbt_model' which was not found
2021-11-11 18:09:19.862797 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:09:19.868182 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e75ec6b-7e22-4754-bb70-36f183de9d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7085429c10>]}
2021-11-11 18:09:19.872964 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:09:19.873336 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e75ec6b-7e22-4754-bb70-36f183de9d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7085348e80>]}
2021-11-11 18:09:19.873678 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:09:19.874908 (MainThread): 
2021-11-11 18:09:19.875313 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:09:19.876194 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:09:19.887475 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:09:19.887723 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:09:19.887905 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:09:19.892233 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:09:19.893617 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:09:19.894866 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:09:19.900605 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:09:19.900819 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:09:19.900989 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:09:19.904312 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:19.904561 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:09:19.904740 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:09:19.907705 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:09:19.909027 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:09:19.909418 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:09:19.913373 (MainThread): Using postgres connection "master".
2021-11-11 18:09:19.913579 (MainThread): On master: BEGIN
2021-11-11 18:09:19.913757 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:09:19.917117 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:19.917372 (MainThread): Using postgres connection "master".
2021-11-11 18:09:19.917541 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:09:19.928549 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:09:19.929975 (MainThread): On master: ROLLBACK
2021-11-11 18:09:19.930498 (MainThread): Using postgres connection "master".
2021-11-11 18:09:19.930683 (MainThread): On master: BEGIN
2021-11-11 18:09:19.931245 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:19.931451 (MainThread): On master: COMMIT
2021-11-11 18:09:19.931666 (MainThread): Using postgres connection "master".
2021-11-11 18:09:19.931826 (MainThread): On master: COMMIT
2021-11-11 18:09:19.932244 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:09:19.932437 (MainThread): On master: Close
2021-11-11 18:09:19.932822 (MainThread): 19:09:19 | Concurrency: 2 threads (target='dev')
2021-11-11 18:09:19.933034 (MainThread): 19:09:19 | 
2021-11-11 18:09:19.935336 (Thread-1): Began running node model.IBA_challenge.num_installations
2021-11-11 18:09:19.935696 (Thread-1): 19:09:19 | 1 of 2 START view model public.num_installations..................... [RUN]
2021-11-11 18:09:19.936066 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.936274 (Thread-1): Compiling model.IBA_challenge.num_installations
2021-11-11 18:09:19.937544 (Thread-1): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:09:19.937858 (Thread-2): Began running node model.IBA_challenge.product_category
2021-11-11 18:09:19.938160 (Thread-2): 19:09:19 | 2 of 2 START view model public.product_category...................... [RUN]
2021-11-11 18:09:19.938439 (Thread-1): finished collecting timing info
2021-11-11 18:09:19.939000 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:09:19.949914 (Thread-2): Compiling model.IBA_challenge.product_category
2021-11-11 18:09:19.951348 (Thread-2): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:09:19.966615 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:09:19.966912 (Thread-2): finished collecting timing info
2021-11-11 18:09:19.970016 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:09:19.970417 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.970606 (Thread-1): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:09:19.970795 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:09:19.971182 (Thread-2): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:09:19.971367 (Thread-2): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:09:19.971530 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:09:19.974370 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:19.974732 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.974954 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:09:19.975178 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:19.975513 (Thread-2): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:09:19.975694 (Thread-2): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues,
--and which region of the world is our best market.
  );

2021-11-11 18:09:19.976177 (Thread-2): Postgres error: syntax error at or near ")"
LINE 6:   );
          ^

2021-11-11 18:09:19.976386 (Thread-2): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:09:19.976726 (Thread-2): finished collecting timing info
2021-11-11 18:09:19.976967 (Thread-2): On model.IBA_challenge.product_category: Close
2021-11-11 18:09:19.978618 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:09:19.985777 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.986072 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:09:19.986941 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:09:19.989182 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.989396 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:09:19.977542 (Thread-2): Database Error in model product_category (models/product_category.sql)
  syntax error at or near ")"
  LINE 6:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 6:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  syntax error at or near ")"
  LINE 6:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:09:19.990067 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e75ec6b-7e22-4754-bb70-36f183de9d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7084a98e50>]}
2021-11-11 18:09:19.990303 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:09:19.996048 (Thread-2): 19:09:19 | 2 of 2 ERROR creating view model public.product_category............. [ERROR in 0.05s]
2021-11-11 18:09:19.997936 (Thread-1): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:09:19.998223 (Thread-2): Finished running node model.IBA_challenge.product_category
2021-11-11 18:09:19.998497 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:19.998814 (Thread-1): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:09:20.000771 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:09:20.005459 (Thread-1): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:09:20.005672 (Thread-1): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:09:20.008292 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:09:20.009726 (Thread-1): finished collecting timing info
2021-11-11 18:09:20.010007 (Thread-1): On model.IBA_challenge.num_installations: Close
2021-11-11 18:09:20.010562 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e75ec6b-7e22-4754-bb70-36f183de9d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7084a88be0>]}
2021-11-11 18:09:20.011249 (Thread-1): 19:09:20 | 1 of 2 OK created view model public.num_installations................ [CREATE VIEW in 0.07s]
2021-11-11 18:09:20.011526 (Thread-1): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:09:20.012733 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:09:20.012980 (MainThread): Using postgres connection "master".
2021-11-11 18:09:20.013152 (MainThread): On master: BEGIN
2021-11-11 18:09:20.013321 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:09:20.016847 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:09:20.017099 (MainThread): On master: COMMIT
2021-11-11 18:09:20.017281 (MainThread): Using postgres connection "master".
2021-11-11 18:09:20.017446 (MainThread): On master: COMMIT
2021-11-11 18:09:20.017849 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:09:20.018076 (MainThread): On master: Close
2021-11-11 18:09:20.018503 (MainThread): 19:09:20 | 
2021-11-11 18:09:20.018718 (MainThread): 19:09:20 | Finished running 2 view models in 0.14s.
2021-11-11 18:09:20.018964 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:09:20.019130 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:09:20.019291 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:09:20.024117 (MainThread): 
2021-11-11 18:09:20.024403 (MainThread): Completed with 1 error and 0 warnings:
2021-11-11 18:09:20.024630 (MainThread): 
2021-11-11 18:09:20.024840 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:09:20.025046 (MainThread):   syntax error at or near ")"
2021-11-11 18:09:20.025224 (MainThread):   LINE 6:   );
2021-11-11 18:09:20.025398 (MainThread):             ^
2021-11-11 18:09:20.025573 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:09:20.025787 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-11-11 18:09:20.026049 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f708533a880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7085458df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7085458b50>]}
2021-11-11 18:09:20.026334 (MainThread): Flushing usage events
2021-11-11 18:47:20.959735 (MainThread): Running with dbt=0.21.0
2021-11-11 18:47:21.028177 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:47:21.029016 (MainThread): Tracking: tracking
2021-11-11 18:47:21.054009 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff918899820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff916dabe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff916dabdf0>]}
2021-11-11 18:47:21.064758 (MainThread): Partial parsing not enabled
2021-11-11 18:47:21.072280 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:47:21.095677 (MainThread): Parsing macros/relations.sql
2021-11-11 18:47:21.097077 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:47:21.099249 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:47:21.100881 (MainThread): Parsing macros/core.sql
2021-11-11 18:47:21.104501 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:47:21.105891 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:47:21.108114 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:47:21.109816 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:47:21.111036 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:47:21.165092 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:47:21.171685 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:47:21.181217 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:47:21.203391 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:47:21.207190 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:47:21.214013 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:47:21.215654 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:47:21.245509 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:47:21.262258 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:47:21.275655 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:47:21.282803 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:47:21.292615 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:47:21.311344 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:47:21.313094 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:47:21.314099 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:47:21.322276 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:47:21.323861 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:47:21.325342 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:47:21.326826 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:47:21.328594 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:47:21.502911 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.515004 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:21.518415 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.568002 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:47:21.573368 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acd85bac-04a4-4539-9007-20704ec6769c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff916cfe6a0>]}
2021-11-11 18:47:21.578649 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:47:21.579034 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acd85bac-04a4-4539-9007-20704ec6769c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff916cd4040>]}
2021-11-11 18:47:21.579382 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:47:21.580945 (MainThread): 
2021-11-11 18:47:21.581914 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:47:21.582992 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:47:21.592907 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:47:21.593145 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:47:21.593346 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:47:21.598552 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 18:47:21.600778 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:47:21.602102 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:47:21.608152 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:47:21.608426 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:47:21.608610 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:47:21.612265 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.612556 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:47:21.612740 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:47:21.616167 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:47:21.617633 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:47:21.618108 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:47:21.622303 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.622527 (MainThread): On master: BEGIN
2021-11-11 18:47:21.622715 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:47:21.626417 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.626732 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.626935 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:47:21.639962 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:47:21.641371 (MainThread): On master: ROLLBACK
2021-11-11 18:47:21.641955 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.642198 (MainThread): On master: BEGIN
2021-11-11 18:47:21.642913 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.643150 (MainThread): On master: COMMIT
2021-11-11 18:47:21.643387 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.643555 (MainThread): On master: COMMIT
2021-11-11 18:47:21.644046 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:47:21.644288 (MainThread): On master: Close
2021-11-11 18:47:21.644717 (MainThread): 19:47:21 | Concurrency: 2 threads (target='dev')
2021-11-11 18:47:21.644948 (MainThread): 19:47:21 | 
2021-11-11 18:47:21.647486 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:47:21.647855 (Thread-1): 19:47:21 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:47:21.648247 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:21.648476 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:47:21.649868 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:47:21.650218 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:47:21.650527 (Thread-2): 19:47:21 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:47:21.650896 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.651102 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:47:21.652454 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:47:21.652896 (Thread-1): finished collecting timing info
2021-11-11 18:47:21.678022 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:47:21.678321 (Thread-2): finished collecting timing info
2021-11-11 18:47:21.680664 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:47:21.680982 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:21.681160 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:47:21.681333 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:47:21.681779 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.682108 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:47:21.682459 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:47:21.685637 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.685935 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:21.686162 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:47:21.686568 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:47:21.686822 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.687165 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:47:21.687379 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.687605 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:47:21.687897 (Thread-1): finished collecting timing info
2021-11-11 18:47:21.688376 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:47:21.691356 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:47:21.698747 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.699161 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:47:21.689131 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:47:21.700012 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acd85bac-04a4-4539-9007-20704ec6769c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff916e45430>]}
2021-11-11 18:47:21.700500 (Thread-1): 19:47:21 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.05s]
2021-11-11 18:47:21.700734 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:21.703028 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.703287 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:47:21.703567 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:47:21.704044 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:47:21.704409 (Thread-1): 19:47:21 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:47:21.704952 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.705187 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:47:21.706514 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:47:21.706794 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:21.713302 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:47:21.713538 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.713736 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:47:21.714015 (Thread-1): finished collecting timing info
2021-11-11 18:47:21.719310 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:47:21.719599 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-11 18:47:21.720087 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.724935 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:21.725215 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:47:21.725472 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:47:21.725732 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:47:21.728140 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:47:21.729382 (Thread-2): finished collecting timing info
2021-11-11 18:47:21.729622 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:47:21.730181 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acd85bac-04a4-4539-9007-20704ec6769c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff914473c40>]}
2021-11-11 18:47:21.730415 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.730872 (Thread-2): 19:47:21 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 18:47:21.731054 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.731327 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:47:21.731513 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:47:21.737217 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 18:47:21.739675 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.739954 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category" rename to "product_category__dbt_backup"
2021-11-11 18:47:21.740717 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:21.743054 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.743286 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category__dbt_tmp" rename to "product_category"
2021-11-11 18:47:21.744156 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:21.745417 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 18:47:21.745610 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.745802 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 18:47:21.747591 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:47:21.749478 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:21.749713 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
drop table if exists "awesomeinc"."public"."product_category__dbt_backup" cascade
2021-11-11 18:47:21.753597 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2021-11-11 18:47:21.754810 (Thread-1): finished collecting timing info
2021-11-11 18:47:21.755049 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:47:21.755477 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acd85bac-04a4-4539-9007-20704ec6769c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff9143d8a90>]}
2021-11-11 18:47:21.755869 (Thread-1): 19:47:21 | 3 of 3 OK created view model public.product_category................. [CREATE VIEW in 0.05s]
2021-11-11 18:47:21.756099 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:47:21.757335 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:47:21.757568 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.757759 (MainThread): On master: BEGIN
2021-11-11 18:47:21.757935 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:47:21.761290 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:21.761542 (MainThread): On master: COMMIT
2021-11-11 18:47:21.761740 (MainThread): Using postgres connection "master".
2021-11-11 18:47:21.761916 (MainThread): On master: COMMIT
2021-11-11 18:47:21.762290 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:47:21.762513 (MainThread): On master: Close
2021-11-11 18:47:21.762940 (MainThread): 19:47:21 | 
2021-11-11 18:47:21.763164 (MainThread): 19:47:21 | Finished running 3 view models in 0.18s.
2021-11-11 18:47:21.763466 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:47:21.763741 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:47:21.763978 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:47:21.768784 (MainThread): 
2021-11-11 18:47:21.769047 (MainThread): Completed with 1 error and 0 warnings:
2021-11-11 18:47:21.769289 (MainThread): 
2021-11-11 18:47:21.769516 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:47:21.769742 (MainThread):   syntax error at or near ")"
2021-11-11 18:47:21.769932 (MainThread):   LINE 5:   );
2021-11-11 18:47:21.770129 (MainThread):             ^
2021-11-11 18:47:21.770326 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:47:21.770533 (MainThread): 
Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
2021-11-11 18:47:21.770814 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff919054430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff91910dd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff91910da60>]}
2021-11-11 18:47:21.771095 (MainThread): Flushing usage events
2021-11-11 18:47:39.158686 (MainThread): Running with dbt=0.21.0
2021-11-11 18:47:39.219596 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:47:39.220294 (MainThread): Tracking: tracking
2021-11-11 18:47:39.243493 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd46d87f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd2be9e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd2be9850>]}
2021-11-11 18:47:39.253739 (MainThread): Partial parsing not enabled
2021-11-11 18:47:39.261108 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:47:39.283812 (MainThread): Parsing macros/relations.sql
2021-11-11 18:47:39.285136 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:47:39.287310 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:47:39.288928 (MainThread): Parsing macros/core.sql
2021-11-11 18:47:39.292489 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:47:39.293844 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:47:39.296005 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:47:39.297626 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:47:39.298842 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:47:39.352396 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:47:39.358895 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:47:39.368247 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:47:39.390049 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:47:39.393800 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:47:39.400515 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:47:39.402142 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:47:39.431386 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:47:39.447814 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:47:39.461634 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:47:39.468863 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:47:39.478837 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:47:39.498673 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:47:39.500416 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:47:39.501389 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:47:39.510133 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:47:39.511894 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:47:39.513403 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:47:39.514911 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:47:39.516666 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:47:39.686759 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.698270 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:39.701232 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:39.748431 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:47:39.753532 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c270d853-67e0-4a70-a0fe-185f7dbd494b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd2b3c6d0>]}
2021-11-11 18:47:39.758634 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:47:39.758986 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c270d853-67e0-4a70-a0fe-185f7dbd494b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd2b2b790>]}
2021-11-11 18:47:39.759299 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:47:39.760665 (MainThread): 
2021-11-11 18:47:39.761075 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:47:39.762530 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:47:39.772392 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:47:39.772633 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:47:39.772850 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:47:39.777455 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:47:39.779081 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:47:39.781435 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:47:39.787242 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:47:39.787467 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:47:39.787643 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:47:39.790788 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.791039 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:47:39.791281 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:47:39.794338 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:47:39.795673 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:47:39.796064 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:47:39.800124 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.800340 (MainThread): On master: BEGIN
2021-11-11 18:47:39.800517 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:47:39.803618 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.803873 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.804055 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:47:39.812965 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:47:39.814307 (MainThread): On master: ROLLBACK
2021-11-11 18:47:39.814779 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.814970 (MainThread): On master: BEGIN
2021-11-11 18:47:39.815656 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.815880 (MainThread): On master: COMMIT
2021-11-11 18:47:39.816112 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.816276 (MainThread): On master: COMMIT
2021-11-11 18:47:39.816685 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:47:39.816900 (MainThread): On master: Close
2021-11-11 18:47:39.817335 (MainThread): 19:47:39 | Concurrency: 2 threads (target='dev')
2021-11-11 18:47:39.817560 (MainThread): 19:47:39 | 
2021-11-11 18:47:39.819920 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:47:39.820323 (Thread-1): 19:47:39 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:47:39.820704 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:39.820917 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:47:39.822225 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:47:39.822553 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:47:39.822855 (Thread-2): 19:47:39 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:47:39.823208 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.823399 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:47:39.824561 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:47:39.825026 (Thread-1): finished collecting timing info
2021-11-11 18:47:39.825271 (Thread-2): finished collecting timing info
2021-11-11 18:47:39.867183 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:47:39.866640 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:47:39.867823 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.868156 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:47:39.868349 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:47:39.868759 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:39.869002 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:47:39.869202 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:47:39.871735 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.872089 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.872316 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:47:39.872998 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.873286 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:47:39.873463 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:47:39.874008 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:47:39.874232 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:47:39.874736 (Thread-1): finished collecting timing info
2021-11-11 18:47:39.875003 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:47:39.875867 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:47:39.882017 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.882296 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:47:39.883181 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:39.885544 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.885841 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:47:39.875486 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:47:39.886604 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:47:39.886950 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c270d853-67e0-4a70-a0fe-185f7dbd494b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd469fdf0>]}
2021-11-11 18:47:39.893660 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:47:39.894216 (Thread-1): 19:47:39 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.07s]
2021-11-11 18:47:39.894408 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.894677 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:47:39.894860 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:47:39.895093 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:47:39.895480 (Thread-1): 19:47:39 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:47:39.896011 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:39.896231 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:47:39.898782 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:47:39.899197 (Thread-1): finished collecting timing info
2021-11-11 18:47:39.901621 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:47:39.901888 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-11 18:47:39.906545 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:47:39.906812 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:47:39.907047 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:39.907275 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:47:39.907467 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:47:39.909363 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:47:39.910615 (Thread-2): finished collecting timing info
2021-11-11 18:47:39.910859 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:47:39.911363 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c270d853-67e0-4a70-a0fe-185f7dbd494b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd029da90>]}
2021-11-11 18:47:39.911590 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.912105 (Thread-2): 19:47:39 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.09s]
2021-11-11 18:47:39.912294 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:47:39.912558 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:47:39.912734 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:47:39.913709 (Thread-1): Postgres error: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^

2021-11-11 18:47:39.914012 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:47:39.914622 (Thread-1): finished collecting timing info
2021-11-11 18:47:39.914929 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:47:39.915392 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:47:39.915998 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c270d853-67e0-4a70-a0fe-185f7dbd494b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd029af40>]}
2021-11-11 18:47:39.916432 (Thread-1): 19:47:39 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.02s]
2021-11-11 18:47:39.916661 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:47:39.917743 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:47:39.917973 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.918137 (MainThread): On master: BEGIN
2021-11-11 18:47:39.918297 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:47:39.921390 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:47:39.921646 (MainThread): On master: COMMIT
2021-11-11 18:47:39.921843 (MainThread): Using postgres connection "master".
2021-11-11 18:47:39.922004 (MainThread): On master: COMMIT
2021-11-11 18:47:39.922453 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:47:39.922665 (MainThread): On master: Close
2021-11-11 18:47:39.923211 (MainThread): 19:47:39 | 
2021-11-11 18:47:39.923604 (MainThread): 19:47:39 | Finished running 3 view models in 0.16s.
2021-11-11 18:47:39.923795 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:47:39.923953 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:47:39.924104 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:47:39.928992 (MainThread): 
2021-11-11 18:47:39.929250 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:47:39.929447 (MainThread): 
2021-11-11 18:47:39.929637 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:47:39.929844 (MainThread):   syntax error at or near ")"
2021-11-11 18:47:39.930012 (MainThread):   LINE 5:   );
2021-11-11 18:47:39.930177 (MainThread):             ^
2021-11-11 18:47:39.930341 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:47:39.930512 (MainThread): 
2021-11-11 18:47:39.930691 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:47:39.930864 (MainThread):   relation "product_category" does not exist
2021-11-11 18:47:39.931032 (MainThread):   LINE 8:  from product_category as pc, product as p
2021-11-11 18:47:39.931195 (MainThread):                 ^
2021-11-11 18:47:39.931357 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:47:39.931530 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:47:39.931772 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd2b09070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd4f49eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4fd4f49e20>]}
2021-11-11 18:47:39.932062 (MainThread): Flushing usage events
2021-11-11 18:48:51.781595 (MainThread): Running with dbt=0.21.0
2021-11-11 18:48:51.843308 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:48:51.844060 (MainThread): Tracking: tracking
2021-11-11 18:48:51.866974 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd807fe16d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8064f6e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8064f6e50>]}
2021-11-11 18:48:51.877402 (MainThread): Partial parsing not enabled
2021-11-11 18:48:51.884890 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:48:51.908085 (MainThread): Parsing macros/relations.sql
2021-11-11 18:48:51.909447 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:48:51.911625 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:48:51.913282 (MainThread): Parsing macros/core.sql
2021-11-11 18:48:51.916874 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:48:51.918246 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:48:51.920459 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:48:51.922111 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:48:51.923323 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:48:51.976559 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:48:51.983046 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:48:51.992494 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:48:52.014480 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:48:52.018310 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:48:52.025088 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:48:52.026734 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:48:52.056171 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:48:52.072733 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:48:52.086060 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:48:52.093125 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:48:52.102910 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:48:52.121570 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:48:52.123298 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:48:52.124295 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:48:52.132408 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:48:52.133980 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:48:52.135454 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:48:52.136944 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:48:52.138734 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:48:52.308608 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.319921 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:48:52.322808 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:48:52.369141 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:48:52.374116 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97d217c3-ec1d-4865-adfa-270947bea754', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd806448700>]}
2021-11-11 18:48:52.379290 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:48:52.379668 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97d217c3-ec1d-4865-adfa-270947bea754', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd80643e190>]}
2021-11-11 18:48:52.380134 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:48:52.381616 (MainThread): 
2021-11-11 18:48:52.382091 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:48:52.383781 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:48:52.394217 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:48:52.394457 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:48:52.394638 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:48:52.400078 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 18:48:52.401801 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:48:52.403258 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:48:52.409030 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:48:52.409290 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:48:52.409464 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:48:52.412700 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.412989 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:48:52.413238 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:48:52.416494 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:48:52.418027 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:48:52.418480 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:48:52.423195 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.423441 (MainThread): On master: BEGIN
2021-11-11 18:48:52.423618 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:48:52.426786 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.427066 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.427243 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:48:52.436545 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:48:52.438121 (MainThread): On master: ROLLBACK
2021-11-11 18:48:52.438639 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.438856 (MainThread): On master: BEGIN
2021-11-11 18:48:52.439440 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.439669 (MainThread): On master: COMMIT
2021-11-11 18:48:52.439855 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.440021 (MainThread): On master: COMMIT
2021-11-11 18:48:52.440425 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:48:52.440663 (MainThread): On master: Close
2021-11-11 18:48:52.441281 (MainThread): 19:48:52 | Concurrency: 2 threads (target='dev')
2021-11-11 18:48:52.441572 (MainThread): 19:48:52 | 
2021-11-11 18:48:52.444276 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:48:52.444559 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:48:52.444938 (Thread-1): 19:48:52 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:48:52.445226 (Thread-2): 19:48:52 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:48:52.445684 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:48:52.446107 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.446375 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:48:52.446621 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:48:52.448150 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:48:52.449366 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:48:52.449776 (Thread-1): finished collecting timing info
2021-11-11 18:48:52.460314 (Thread-2): finished collecting timing info
2021-11-11 18:48:52.480292 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:48:52.481194 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:48:52.481670 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.481885 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:48:52.482065 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:48:52.482455 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:48:52.482839 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:48:52.483121 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:48:52.485920 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.486303 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.486529 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:48:52.486733 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.487038 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:48:52.487210 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:48:52.487555 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:48:52.487766 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:48:52.488116 (Thread-1): finished collecting timing info
2021-11-11 18:48:52.488352 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:48:52.489748 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:48:52.496260 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.496540 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:48:52.488821 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:48:52.497458 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:48:52.497881 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97d217c3-ec1d-4865-adfa-270947bea754', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8064122e0>]}
2021-11-11 18:48:52.501060 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.501481 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:48:52.501963 (Thread-1): 19:48:52 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.05s]
2021-11-11 18:48:52.502286 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:48:52.502523 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:48:52.502872 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:48:52.503210 (Thread-1): 19:48:52 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:48:52.510865 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:48:52.511419 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:48:52.511598 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.511904 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:48:52.512132 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:48:52.513436 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:48:52.513904 (Thread-1): finished collecting timing info
2021-11-11 18:48:52.517439 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:48:52.517738 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:48:52.518127 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:48:52.523239 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:48:52.523507 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:48:52.523761 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:48:52.523962 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:48:52.526210 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:48:52.527580 (Thread-2): finished collecting timing info
2021-11-11 18:48:52.527987 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:48:52.528675 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97d217c3-ec1d-4865-adfa-270947bea754', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8043a1970>]}
2021-11-11 18:48:52.528984 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 18:48:52.529467 (Thread-2): 19:48:52 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 18:48:52.529645 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:48:52.529937 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:48:52.530119 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:48:52.531013 (Thread-1): Postgres error: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^

2021-11-11 18:48:52.531244 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:48:52.531900 (Thread-1): finished collecting timing info
2021-11-11 18:48:52.532299 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:48:52.533025 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:48:52.534093 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97d217c3-ec1d-4865-adfa-270947bea754', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd806412a30>]}
2021-11-11 18:48:52.534525 (Thread-1): 19:48:52 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.02s]
2021-11-11 18:48:52.534771 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:48:52.535962 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:48:52.536220 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.536416 (MainThread): On master: BEGIN
2021-11-11 18:48:52.536614 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:48:52.540079 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:48:52.540434 (MainThread): On master: COMMIT
2021-11-11 18:48:52.540647 (MainThread): Using postgres connection "master".
2021-11-11 18:48:52.540852 (MainThread): On master: COMMIT
2021-11-11 18:48:52.541241 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:48:52.541451 (MainThread): On master: Close
2021-11-11 18:48:52.541948 (MainThread): 19:48:52 | 
2021-11-11 18:48:52.542173 (MainThread): 19:48:52 | Finished running 3 view models in 0.16s.
2021-11-11 18:48:52.542401 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:48:52.542565 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:48:52.542720 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:48:52.547119 (MainThread): 
2021-11-11 18:48:52.547382 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:48:52.547660 (MainThread): 
2021-11-11 18:48:52.547960 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:48:52.548254 (MainThread):   syntax error at or near ")"
2021-11-11 18:48:52.548457 (MainThread):   LINE 5:   );
2021-11-11 18:48:52.548659 (MainThread):             ^
2021-11-11 18:48:52.548863 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:48:52.549042 (MainThread): 
2021-11-11 18:48:52.549272 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:48:52.549448 (MainThread):   relation "product_category" does not exist
2021-11-11 18:48:52.549613 (MainThread):   LINE 8:  from product_category as pc, product as p
2021-11-11 18:48:52.549804 (MainThread):                 ^
2021-11-11 18:48:52.549970 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:48:52.550151 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:48:52.550394 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd808805610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd808843c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd808843dc0>]}
2021-11-11 18:48:52.550670 (MainThread): Flushing usage events
2021-11-11 18:49:13.208653 (MainThread): Running with dbt=0.21.0
2021-11-11 18:49:13.270472 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:49:13.271319 (MainThread): Tracking: tracking
2021-11-11 18:49:13.295051 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ecaeb1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ee5d2940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ecae6c10>]}
2021-11-11 18:49:13.305391 (MainThread): Partial parsing not enabled
2021-11-11 18:49:13.312770 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:49:13.335963 (MainThread): Parsing macros/relations.sql
2021-11-11 18:49:13.337329 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:49:13.339504 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:49:13.341137 (MainThread): Parsing macros/core.sql
2021-11-11 18:49:13.344891 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:49:13.346271 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:49:13.348481 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:49:13.350150 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:49:13.351358 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:49:13.404855 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:49:13.411349 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:49:13.420868 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:49:13.443006 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:49:13.446801 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:49:13.453605 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:49:13.455299 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:49:13.486066 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:49:13.503611 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:49:13.517828 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:49:13.525026 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:49:13.534791 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:49:13.554426 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:49:13.556249 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:49:13.557273 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:49:13.565658 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:49:13.567384 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:49:13.568975 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:49:13.570593 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:49:13.572478 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:49:13.742535 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.754061 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:49:13.784647 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:49:13.803942 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:49:13.808837 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a5520b31-05ef-4ce0-8085-09d57b144671', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec9dc430>]}
2021-11-11 18:49:13.813982 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:49:13.814336 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a5520b31-05ef-4ce0-8085-09d57b144671', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0eca31040>]}
2021-11-11 18:49:13.814653 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:49:13.816013 (MainThread): 
2021-11-11 18:49:13.816429 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:49:13.817872 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:49:13.827555 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:49:13.827782 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:49:13.828002 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:49:13.832878 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:49:13.834447 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:49:13.836909 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:49:13.842585 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:49:13.842831 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:49:13.843004 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:49:13.846408 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.846669 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:49:13.846846 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:49:13.850006 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:49:13.851358 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:49:13.851831 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:49:13.855917 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.856155 (MainThread): On master: BEGIN
2021-11-11 18:49:13.856328 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:49:13.859499 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.859748 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.859977 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:49:13.868612 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:49:13.870434 (MainThread): On master: ROLLBACK
2021-11-11 18:49:13.870953 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.871159 (MainThread): On master: BEGIN
2021-11-11 18:49:13.871786 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.872080 (MainThread): On master: COMMIT
2021-11-11 18:49:13.872318 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.872575 (MainThread): On master: COMMIT
2021-11-11 18:49:13.872954 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:49:13.873178 (MainThread): On master: Close
2021-11-11 18:49:13.873668 (MainThread): 19:49:13 | Concurrency: 2 threads (target='dev')
2021-11-11 18:49:13.873979 (MainThread): 19:49:13 | 
2021-11-11 18:49:13.876166 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:49:13.876525 (Thread-1): 19:49:13 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:49:13.876945 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:49:13.877227 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:49:13.877456 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:49:13.877759 (Thread-2): 19:49:13 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:49:13.879132 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:49:13.879569 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.879902 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:49:13.881052 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:49:13.881403 (Thread-1): finished collecting timing info
2021-11-11 18:49:13.881619 (Thread-2): finished collecting timing info
2021-11-11 18:49:13.926881 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:49:13.927742 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:49:13.928139 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.928327 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:49:13.928501 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:49:13.928909 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:49:13.929175 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:49:13.929352 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:49:13.931949 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.932262 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.932488 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.932689 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:49:13.932880 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:49:13.933072 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:49:13.933524 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:49:13.933738 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:49:13.934175 (Thread-1): finished collecting timing info
2021-11-11 18:49:13.934406 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:49:13.936012 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:49:13.942192 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.942423 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:49:13.934818 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:49:13.943225 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5520b31-05ef-4ce0-8085-09d57b144671', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec9ff850>]}
2021-11-11 18:49:13.943701 (Thread-1): 19:49:13 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.07s]
2021-11-11 18:49:13.943929 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:49:13.944152 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:49:13.944425 (Thread-1): 19:49:13 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:49:13.944858 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:49:13.945066 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:49:13.947406 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:49:13.947717 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2021-11-11 18:49:13.949753 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.949975 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:49:13.950449 (Thread-1): finished collecting timing info
2021-11-11 18:49:13.952799 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:49:13.953149 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:49:13.960423 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:49:13.960691 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.960872 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:49:13.961171 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:49:13.961365 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:49:13.961540 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:49:13.964997 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.965246 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:49:13.965428 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:49:13.965632 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:49:13.970856 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:49:13.971125 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:49:13.971377 (Thread-1): Postgres error: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^

2021-11-11 18:49:13.971745 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:49:13.972358 (Thread-1): finished collecting timing info
2021-11-11 18:49:13.972618 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:49:13.973608 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:49:13.975326 (Thread-2): finished collecting timing info
2021-11-11 18:49:13.975733 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:49:13.976459 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5520b31-05ef-4ce0-8085-09d57b144671', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec194a30>]}
2021-11-11 18:49:13.973054 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:49:13.977332 (Thread-2): 19:49:13 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.10s]
2021-11-11 18:49:13.977835 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5520b31-05ef-4ce0-8085-09d57b144671', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ecb6d2e0>]}
2021-11-11 18:49:13.978129 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:49:13.978692 (Thread-1): 19:49:13 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.03s]
2021-11-11 18:49:13.979122 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:49:13.980261 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:49:13.980514 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.980686 (MainThread): On master: BEGIN
2021-11-11 18:49:13.980852 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:49:13.984087 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:49:13.984360 (MainThread): On master: COMMIT
2021-11-11 18:49:13.984551 (MainThread): Using postgres connection "master".
2021-11-11 18:49:13.984721 (MainThread): On master: COMMIT
2021-11-11 18:49:13.985086 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:49:13.985281 (MainThread): On master: Close
2021-11-11 18:49:13.985687 (MainThread): 19:49:13 | 
2021-11-11 18:49:13.985919 (MainThread): 19:49:13 | Finished running 3 view models in 0.17s.
2021-11-11 18:49:13.986121 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:49:13.986296 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:49:13.986450 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:49:13.991265 (MainThread): 
2021-11-11 18:49:13.991519 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:49:13.991723 (MainThread): 
2021-11-11 18:49:13.991921 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:49:13.992099 (MainThread):   syntax error at or near ")"
2021-11-11 18:49:13.992268 (MainThread):   LINE 5:   );
2021-11-11 18:49:13.992440 (MainThread):             ^
2021-11-11 18:49:13.992611 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:49:13.992790 (MainThread): 
2021-11-11 18:49:13.992973 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:49:13.993148 (MainThread):   relation "product_category" does not exist
2021-11-11 18:49:13.993314 (MainThread):   LINE 8:  from product_category as pc, product as p
2021-11-11 18:49:13.993480 (MainThread):                 ^
2021-11-11 18:49:13.993647 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:49:13.993855 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:49:13.994106 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ee59bfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0eed81c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec9dc580>]}
2021-11-11 18:49:13.994383 (MainThread): Flushing usage events
2021-11-11 18:53:47.998296 (MainThread): Running with dbt=0.21.0
2021-11-11 18:53:48.061404 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:53:48.062255 (MainThread): Tracking: tracking
2021-11-11 18:53:48.085592 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9735ff760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa971b10df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa971b107c0>]}
2021-11-11 18:53:48.096017 (MainThread): Partial parsing not enabled
2021-11-11 18:53:48.104388 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:53:48.127508 (MainThread): Parsing macros/relations.sql
2021-11-11 18:53:48.128860 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:53:48.131020 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:53:48.132655 (MainThread): Parsing macros/core.sql
2021-11-11 18:53:48.136275 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:53:48.137640 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:53:48.139832 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:53:48.141473 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:53:48.142683 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:53:48.195594 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:53:48.202014 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:53:48.211421 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:53:48.233256 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:53:48.237044 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:53:48.243808 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:53:48.245464 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:53:48.275014 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:53:48.292236 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:53:48.306030 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:53:48.313237 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:53:48.323530 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:53:48.342773 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:53:48.344676 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:53:48.345650 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:53:48.354069 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:53:48.355668 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:53:48.357224 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:53:48.358982 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:53:48.360747 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:53:48.538646 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.550654 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:53:48.553950 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:53:48.603992 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:53:48.609391 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ec63d87-ef7f-4e23-b04a-b9b9f6d6ac22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa971a64640>]}
2021-11-11 18:53:48.615557 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:53:48.615975 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ec63d87-ef7f-4e23-b04a-b9b9f6d6ac22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa971a59430>]}
2021-11-11 18:53:48.616308 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:53:48.617995 (MainThread): 
2021-11-11 18:53:48.618528 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:53:48.619630 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:53:48.629571 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:53:48.629860 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:53:48.630043 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:53:48.635022 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:53:48.636699 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:53:48.638040 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:53:48.643827 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:53:48.644055 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:53:48.644232 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:53:48.647531 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.647850 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:53:48.648096 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:53:48.651410 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:53:48.652857 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:53:48.653371 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:53:48.658061 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.658329 (MainThread): On master: BEGIN
2021-11-11 18:53:48.658513 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:53:48.661852 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.662275 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.662544 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:53:48.671999 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:53:48.673296 (MainThread): On master: ROLLBACK
2021-11-11 18:53:48.673622 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.673825 (MainThread): On master: BEGIN
2021-11-11 18:53:48.674413 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.674630 (MainThread): On master: COMMIT
2021-11-11 18:53:48.674873 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.675041 (MainThread): On master: COMMIT
2021-11-11 18:53:48.675476 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:53:48.675708 (MainThread): On master: Close
2021-11-11 18:53:48.676150 (MainThread): 19:53:48 | Concurrency: 2 threads (target='dev')
2021-11-11 18:53:48.676431 (MainThread): 19:53:48 | 
2021-11-11 18:53:48.678706 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:53:48.679098 (Thread-1): 19:53:48 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:53:48.679350 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:53:48.679793 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:53:48.680131 (Thread-2): 19:53:48 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:53:48.680414 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:53:48.680823 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.682253 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:53:48.682593 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:53:48.684059 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:53:48.684465 (Thread-1): finished collecting timing info
2021-11-11 18:53:48.689804 (Thread-2): finished collecting timing info
2021-11-11 18:53:48.724257 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:53:48.725610 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:53:48.726101 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:53:48.726309 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:53:48.726488 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:53:48.726860 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.727062 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:53:48.727271 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:53:48.730053 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.730450 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:53:48.730714 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:53:48.731045 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.731309 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.731533 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:53:48.731826 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:53:48.732125 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:53:48.732583 (Thread-1): finished collecting timing info
2021-11-11 18:53:48.733035 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:53:48.735878 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:53:48.743337 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.743784 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:53:48.733818 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:53:48.744764 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ec63d87-ef7f-4e23-b04a-b9b9f6d6ac22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa971a2f250>]}
2021-11-11 18:53:48.745060 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:53:48.745618 (Thread-1): 19:53:48 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.07s]
2021-11-11 18:53:48.748258 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.748629 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:53:48.748866 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:53:48.749127 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:53:48.750314 (Thread-1): 19:53:48 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:53:48.750768 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:53:48.750971 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:53:48.751234 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:53:48.758130 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:53:48.761073 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:53:48.761335 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.761647 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:53:48.761994 (Thread-1): finished collecting timing info
2021-11-11 18:53:48.764289 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:53:48.764719 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:53:48.764903 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:53:48.765074 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:53:48.768268 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.768577 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:53:48.768789 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:53:48.769429 (Thread-1): Postgres error: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^

2021-11-11 18:53:48.769721 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:53:48.770293 (Thread-1): finished collecting timing info
2021-11-11 18:53:48.770654 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:53:48.771396 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-11 18:53:48.776421 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:53:48.776772 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:53:48.771120 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:53:48.777665 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ec63d87-ef7f-4e23-b04a-b9b9f6d6ac22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa97013ddf0>]}
2021-11-11 18:53:48.778299 (Thread-1): 19:53:48 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.03s]
2021-11-11 18:53:48.778694 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:53:48.779213 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:53:48.780544 (Thread-2): finished collecting timing info
2021-11-11 18:53:48.780793 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:53:48.781279 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ec63d87-ef7f-4e23-b04a-b9b9f6d6ac22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9701bfcd0>]}
2021-11-11 18:53:48.781775 (Thread-2): 19:53:48 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.10s]
2021-11-11 18:53:48.782168 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:53:48.783446 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:53:48.783694 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.783873 (MainThread): On master: BEGIN
2021-11-11 18:53:48.784045 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:53:48.787063 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:53:48.787429 (MainThread): On master: COMMIT
2021-11-11 18:53:48.787732 (MainThread): Using postgres connection "master".
2021-11-11 18:53:48.787956 (MainThread): On master: COMMIT
2021-11-11 18:53:48.788314 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:53:48.788582 (MainThread): On master: Close
2021-11-11 18:53:48.789039 (MainThread): 19:53:48 | 
2021-11-11 18:53:48.789259 (MainThread): 19:53:48 | Finished running 3 view models in 0.17s.
2021-11-11 18:53:48.789504 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:53:48.789724 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:53:48.789923 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:53:48.794590 (MainThread): 
2021-11-11 18:53:48.794838 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:53:48.795035 (MainThread): 
2021-11-11 18:53:48.795227 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:53:48.795407 (MainThread):   syntax error at or near ")"
2021-11-11 18:53:48.795577 (MainThread):   LINE 5:   );
2021-11-11 18:53:48.795745 (MainThread):             ^
2021-11-11 18:53:48.795911 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:53:48.796084 (MainThread): 
2021-11-11 18:53:48.796268 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:53:48.796459 (MainThread):   relation "product_category" does not exist
2021-11-11 18:53:48.796631 (MainThread):   LINE 8:  from product_category as pc, product as p
2021-11-11 18:53:48.796800 (MainThread):                 ^
2021-11-11 18:53:48.796966 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:53:48.797142 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:53:48.797381 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa973dba0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa973dab5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa973dab310>]}
2021-11-11 18:53:48.797786 (MainThread): Flushing usage events
2021-11-11 18:54:45.870981 (MainThread): Running with dbt=0.21.0
2021-11-11 18:54:45.932320 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:54:45.933092 (MainThread): Tracking: tracking
2021-11-11 18:54:45.957068 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5ab6186d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9b2de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9b2de50>]}
2021-11-11 18:54:45.967533 (MainThread): Partial parsing not enabled
2021-11-11 18:54:45.975376 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:54:46.000458 (MainThread): Parsing macros/relations.sql
2021-11-11 18:54:46.001865 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:54:46.004013 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:54:46.005654 (MainThread): Parsing macros/core.sql
2021-11-11 18:54:46.009261 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:54:46.010656 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:54:46.012854 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:54:46.014500 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:54:46.015720 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:54:46.069188 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:54:46.075695 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:54:46.085128 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:54:46.107102 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:54:46.110885 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:54:46.117612 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:54:46.119256 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:54:46.148469 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:54:46.165059 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:54:46.178332 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:54:46.185384 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:54:46.195024 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:54:46.213639 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:54:46.215401 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:54:46.216378 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:54:46.224489 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:54:46.226069 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:54:46.227546 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:54:46.229002 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:54:46.230782 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:54:46.400914 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.417677 (MainThread): 1699: statically parsed best_market_region.sql
2021-11-11 18:54:46.418032 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:54:46.420574 (MainThread): Sending event: {'category': 'dbt', 'action': 'experimental_parser', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9ab8070>]}
2021-11-11 18:54:46.421740 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:54:46.471836 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:54:46.477214 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9a7f700>]}
2021-11-11 18:54:46.482405 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:54:46.482767 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9a760a0>]}
2021-11-11 18:54:46.483094 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:54:46.484446 (MainThread): 
2021-11-11 18:54:46.484857 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:54:46.486322 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:54:46.496427 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:54:46.496689 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:54:46.496866 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:54:46.501192 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:54:46.503120 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:54:46.504490 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:54:46.510165 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:54:46.510384 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:54:46.510568 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:54:46.513883 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.514168 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:54:46.514344 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:54:46.517390 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:54:46.518716 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:54:46.519207 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:54:46.523319 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.523537 (MainThread): On master: BEGIN
2021-11-11 18:54:46.523712 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:54:46.527250 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.527608 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.527791 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:54:46.536828 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:54:46.538309 (MainThread): On master: ROLLBACK
2021-11-11 18:54:46.538864 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.539084 (MainThread): On master: BEGIN
2021-11-11 18:54:46.539581 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.539831 (MainThread): On master: COMMIT
2021-11-11 18:54:46.540018 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.540203 (MainThread): On master: COMMIT
2021-11-11 18:54:46.540637 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:54:46.540865 (MainThread): On master: Close
2021-11-11 18:54:46.541317 (MainThread): 19:54:46 | Concurrency: 2 threads (target='dev')
2021-11-11 18:54:46.541553 (MainThread): 19:54:46 | 
2021-11-11 18:54:46.544017 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:54:46.544298 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:54:46.544707 (Thread-1): 19:54:46 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:54:46.544994 (Thread-2): 19:54:46 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:54:46.545503 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:54:46.545887 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.546087 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:54:46.546291 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:54:46.547626 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:54:46.548787 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:54:46.549172 (Thread-1): finished collecting timing info
2021-11-11 18:54:46.559728 (Thread-2): finished collecting timing info
2021-11-11 18:54:46.581954 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:54:46.582324 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:54:46.582835 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.583022 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:54:46.583193 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:54:46.583554 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:54:46.583776 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:54:46.584086 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:54:46.586595 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.587040 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.587300 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:54:46.587541 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.587755 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:54:46.587919 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:54:46.588289 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:54:46.588512 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:54:46.589042 (Thread-1): finished collecting timing info
2021-11-11 18:54:46.589318 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:54:46.590177 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:54:46.597513 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.597822 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:54:46.598708 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:54:46.600842 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.601065 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:54:46.601771 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:54:46.608864 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:54:46.609129 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.609304 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:54:46.589732 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:54:46.609920 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a9b375b0>]}
2021-11-11 18:54:46.610339 (Thread-1): 19:54:46 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.06s]
2021-11-11 18:54:46.610562 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:54:46.610799 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:54:46.611061 (Thread-1): 19:54:46 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:54:46.611432 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:54:46.611670 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:54:46.612894 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:54:46.613380 (Thread-1): finished collecting timing info
2021-11-11 18:54:46.616603 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:54:46.616937 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-11 18:54:46.621442 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:54:46.621721 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:54:46.622650 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:54:46.622878 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:54:46.623060 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:54:46.624796 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:54:46.626345 (Thread-2): finished collecting timing info
2021-11-11 18:54:46.626642 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:54:46.627201 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5abe8ca30>]}
2021-11-11 18:54:46.627658 (Thread-2): 19:54:46 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 18:54:46.627950 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.628157 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:54:46.628330 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from 'dbt-IBA'.IBA_challenge.product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:54:46.628551 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:54:46.629026 (Thread-1): Postgres error: syntax error at or near "'dbt-IBA'"
LINE 8:  from 'dbt-IBA'.IBA_challenge.product_category as pc, produc...
              ^

2021-11-11 18:54:46.629253 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:54:46.629641 (Thread-1): finished collecting timing info
2021-11-11 18:54:46.629872 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:54:46.630418 (Thread-1): Database Error in model product_category (models/product_category.sql)
  syntax error at or near "'dbt-IBA'"
  LINE 8:  from 'dbt-IBA'.IBA_challenge.product_category as pc, produc...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "'dbt-IBA'"
LINE 8:  from 'dbt-IBA'.IBA_challenge.product_category as pc, produc...
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  syntax error at or near "'dbt-IBA'"
  LINE 8:  from 'dbt-IBA'.IBA_challenge.product_category as pc, produc...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:54:46.631380 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60efa4ac-e277-43fd-ae22-e8f2a88c7b93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5a8151b20>]}
2021-11-11 18:54:46.631924 (Thread-1): 19:54:46 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.02s]
2021-11-11 18:54:46.632157 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:54:46.633308 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:54:46.633539 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.633721 (MainThread): On master: BEGIN
2021-11-11 18:54:46.633899 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:54:46.637255 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:54:46.637576 (MainThread): On master: COMMIT
2021-11-11 18:54:46.637883 (MainThread): Using postgres connection "master".
2021-11-11 18:54:46.638074 (MainThread): On master: COMMIT
2021-11-11 18:54:46.638486 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:54:46.638707 (MainThread): On master: Close
2021-11-11 18:54:46.639196 (MainThread): 19:54:46 | 
2021-11-11 18:54:46.639434 (MainThread): 19:54:46 | Finished running 3 view models in 0.15s.
2021-11-11 18:54:46.639654 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:54:46.639833 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:54:46.639990 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:54:46.644788 (MainThread): 
2021-11-11 18:54:46.645071 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:54:46.645287 (MainThread): 
2021-11-11 18:54:46.645487 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:54:46.645675 (MainThread):   syntax error at or near ")"
2021-11-11 18:54:46.645864 (MainThread):   LINE 5:   );
2021-11-11 18:54:46.646032 (MainThread):             ^
2021-11-11 18:54:46.646198 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:54:46.646373 (MainThread): 
2021-11-11 18:54:46.646555 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:54:46.646731 (MainThread):   syntax error at or near "'dbt-IBA'"
2021-11-11 18:54:46.646898 (MainThread):   LINE 8:  from 'dbt-IBA'.IBA_challenge.product_category as pc, produc...
2021-11-11 18:54:46.647083 (MainThread):                 ^
2021-11-11 18:54:46.647250 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:54:46.647427 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:54:46.647669 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5ab8ce880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5ab8ce850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5abe35610>]}
2021-11-11 18:54:46.647943 (MainThread): Flushing usage events
2021-11-11 18:57:40.346639 (MainThread): Running with dbt=0.21.0
2021-11-11 18:57:40.408050 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 18:57:40.408796 (MainThread): Tracking: tracking
2021-11-11 18:57:40.432162 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523c310490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a821dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a821790>]}
2021-11-11 18:57:40.442589 (MainThread): Partial parsing not enabled
2021-11-11 18:57:40.449996 (MainThread): Parsing macros/adapters.sql
2021-11-11 18:57:40.477270 (MainThread): Parsing macros/relations.sql
2021-11-11 18:57:40.480870 (MainThread): Parsing macros/catalog.sql
2021-11-11 18:57:40.484314 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 18:57:40.486017 (MainThread): Parsing macros/core.sql
2021-11-11 18:57:40.489609 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 18:57:40.490985 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 18:57:40.493872 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 18:57:40.495695 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 18:57:40.497644 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 18:57:40.551825 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 18:57:40.559073 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 18:57:40.568783 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 18:57:40.590950 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 18:57:40.594770 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 18:57:40.601609 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 18:57:40.603265 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 18:57:40.632899 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 18:57:40.649459 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 18:57:40.662999 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 18:57:40.670062 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 18:57:40.679803 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 18:57:40.698645 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 18:57:40.700357 (MainThread): Parsing macros/etc/query.sql
2021-11-11 18:57:40.701315 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 18:57:40.709539 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 18:57:40.711122 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 18:57:40.712593 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 18:57:40.714072 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 18:57:40.715821 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 18:57:40.885392 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:40.896734 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:57:40.899667 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:57:40.947002 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 18:57:40.952604 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '609bd657-cdb6-4190-8884-bc7a23a18aef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a774610>]}
2021-11-11 18:57:40.957951 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 18:57:40.958435 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '609bd657-cdb6-4190-8884-bc7a23a18aef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a74b100>]}
2021-11-11 18:57:40.958788 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 18:57:40.960164 (MainThread): 
2021-11-11 18:57:40.961049 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:57:40.962090 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 18:57:40.973019 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 18:57:40.973452 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 18:57:40.973833 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 18:57:40.978118 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 18:57:40.979903 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 18:57:40.981523 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 18:57:40.987942 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:57:40.988202 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 18:57:40.988384 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 18:57:40.991768 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:40.992117 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 18:57:40.992375 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 18:57:40.995958 (ThreadPoolExecutor-1_0): SQL status: SELECT 5 in 0.00 seconds
2021-11-11 18:57:40.997358 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 18:57:40.997671 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 18:57:41.002350 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.002588 (MainThread): On master: BEGIN
2021-11-11 18:57:41.002766 (MainThread): Opening a new connection, currently in state init
2021-11-11 18:57:41.006288 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:41.006633 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.006815 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 18:57:41.016507 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 18:57:41.018029 (MainThread): On master: ROLLBACK
2021-11-11 18:57:41.018634 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.018839 (MainThread): On master: BEGIN
2021-11-11 18:57:41.019538 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:41.019771 (MainThread): On master: COMMIT
2021-11-11 18:57:41.019973 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.020143 (MainThread): On master: COMMIT
2021-11-11 18:57:41.020536 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:57:41.020746 (MainThread): On master: Close
2021-11-11 18:57:41.021185 (MainThread): 19:57:41 | Concurrency: 2 threads (target='dev')
2021-11-11 18:57:41.021406 (MainThread): 19:57:41 | 
2021-11-11 18:57:41.023868 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 18:57:41.024245 (Thread-1): 19:57:41 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 18:57:41.024643 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:57:41.024855 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 18:57:41.026207 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:57:41.026521 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 18:57:41.026873 (Thread-2): 19:57:41 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 18:57:41.027072 (Thread-1): finished collecting timing info
2021-11-11 18:57:41.027526 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.038023 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 18:57:41.056678 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:57:41.058164 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 18:57:41.058838 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:57:41.059085 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 18:57:41.059325 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:57:41.059704 (Thread-2): finished collecting timing info
2021-11-11 18:57:41.061978 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 18:57:41.062753 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.063279 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:41.063546 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 18:57:41.063804 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 18:57:41.064052 (Thread-2): Opening a new connection, currently in state init
2021-11-11 18:57:41.064293 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 18:57:41.064994 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 18:57:41.065205 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 18:57:41.065582 (Thread-1): finished collecting timing info
2021-11-11 18:57:41.065838 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 18:57:41.067471 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:41.067751 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.067977 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 18:57:41.066361 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:57:41.069074 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '609bd657-cdb6-4190-8884-bc7a23a18aef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a8a4c10>]}
2021-11-11 18:57:41.069479 (Thread-1): 19:57:41 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.04s]
2021-11-11 18:57:41.069824 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 18:57:41.070053 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 18:57:41.070559 (Thread-1): 19:57:41 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 18:57:41.070826 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 18:57:41.076387 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:57:41.078097 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.078369 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 18:57:41.078590 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 18:57:41.080059 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:57:41.080626 (Thread-1): finished collecting timing info
2021-11-11 18:57:41.083502 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 18:57:41.083781 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:57:41.087135 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.087373 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 18:57:41.087635 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:57:41.087831 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 18:57:41.088044 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 18:57:41.088221 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 18:57:41.095344 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:57:41.095746 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.095945 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 18:57:41.096152 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 18:57:41.096429 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 18:57:41.096604 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from awesomeinc.product_category as pc, awesomeinc.product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 18:57:41.099982 (Thread-1): Postgres error: relation "awesomeinc.product_category" does not exist
LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
              ^

2021-11-11 18:57:41.100198 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 18:57:41.100609 (Thread-1): finished collecting timing info
2021-11-11 18:57:41.100866 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 18:57:41.101225 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:57:41.107071 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 18:57:41.107478 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 18:57:41.101857 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product_category" does not exist
  LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "awesomeinc.product_category" does not exist
LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product_category" does not exist
  LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:57:41.108193 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '609bd657-cdb6-4190-8884-bc7a23a18aef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523c5ca7f0>]}
2021-11-11 18:57:41.108656 (Thread-1): 19:57:41 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.03s]
2021-11-11 18:57:41.108891 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 18:57:41.109804 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 18:57:41.111094 (Thread-2): finished collecting timing info
2021-11-11 18:57:41.111364 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 18:57:41.111907 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '609bd657-cdb6-4190-8884-bc7a23a18aef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523a73bbb0>]}
2021-11-11 18:57:41.112399 (Thread-2): 19:57:41 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 18:57:41.112696 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 18:57:41.113903 (MainThread): Acquiring new postgres connection "master".
2021-11-11 18:57:41.114286 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.114587 (MainThread): On master: BEGIN
2021-11-11 18:57:41.114885 (MainThread): Opening a new connection, currently in state closed
2021-11-11 18:57:41.118409 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 18:57:41.118713 (MainThread): On master: COMMIT
2021-11-11 18:57:41.118906 (MainThread): Using postgres connection "master".
2021-11-11 18:57:41.119089 (MainThread): On master: COMMIT
2021-11-11 18:57:41.119423 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 18:57:41.119649 (MainThread): On master: Close
2021-11-11 18:57:41.120149 (MainThread): 19:57:41 | 
2021-11-11 18:57:41.120392 (MainThread): 19:57:41 | Finished running 3 view models in 0.16s.
2021-11-11 18:57:41.120645 (MainThread): Connection 'master' was properly closed.
2021-11-11 18:57:41.120837 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 18:57:41.121008 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 18:57:41.125987 (MainThread): 
2021-11-11 18:57:41.126247 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 18:57:41.126445 (MainThread): 
2021-11-11 18:57:41.126636 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 18:57:41.126832 (MainThread):   syntax error at or near ")"
2021-11-11 18:57:41.127022 (MainThread):   LINE 5:   );
2021-11-11 18:57:41.127230 (MainThread):             ^
2021-11-11 18:57:41.127406 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 18:57:41.127587 (MainThread): 
2021-11-11 18:57:41.127774 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 18:57:41.127954 (MainThread):   relation "awesomeinc.product_category" does not exist
2021-11-11 18:57:41.128127 (MainThread):   LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
2021-11-11 18:57:41.128298 (MainThread):                 ^
2021-11-11 18:57:41.128467 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 18:57:41.128649 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 18:57:41.128904 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523cabc2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523cabc280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f523cabc580>]}
2021-11-11 18:57:41.129195 (MainThread): Flushing usage events
2021-11-11 19:05:16.591719 (MainThread): Running with dbt=0.21.0
2021-11-11 19:05:16.655617 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 19:05:16.656396 (MainThread): Tracking: tracking
2021-11-11 19:05:16.679670 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e8e5400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f11903eb580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e8fcb50>]}
2021-11-11 19:05:16.690029 (MainThread): Partial parsing not enabled
2021-11-11 19:05:16.697518 (MainThread): Parsing macros/adapters.sql
2021-11-11 19:05:16.722520 (MainThread): Parsing macros/relations.sql
2021-11-11 19:05:16.724042 (MainThread): Parsing macros/catalog.sql
2021-11-11 19:05:16.726305 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 19:05:16.727971 (MainThread): Parsing macros/core.sql
2021-11-11 19:05:16.731716 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 19:05:16.733149 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 19:05:16.735372 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 19:05:16.737014 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 19:05:16.738236 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 19:05:16.791090 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 19:05:16.797556 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 19:05:16.807159 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 19:05:16.829111 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 19:05:16.832899 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 19:05:16.839660 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 19:05:16.841311 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 19:05:16.870768 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 19:05:16.887586 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 19:05:16.901035 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 19:05:16.908178 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 19:05:16.917871 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 19:05:16.936577 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 19:05:16.938297 (MainThread): Parsing macros/etc/query.sql
2021-11-11 19:05:16.939275 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 19:05:16.947593 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 19:05:16.949245 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 19:05:16.950744 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 19:05:16.952222 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 19:05:16.953982 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 19:05:17.126030 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.137639 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:17.168435 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:17.187808 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 19:05:17.192659 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1464eca2-88ea-4242-bf52-74ff513066d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e7f0100>]}
2021-11-11 19:05:17.197779 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 19:05:17.198123 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1464eca2-88ea-4242-bf52-74ff513066d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e845250>]}
2021-11-11 19:05:17.198435 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 19:05:17.200101 (MainThread): 
2021-11-11 19:05:17.200537 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:17.202520 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 19:05:17.212210 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 19:05:17.212449 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 19:05:17.212687 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 19:05:17.218158 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 19:05:17.221002 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 19:05:17.222662 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 19:05:17.228589 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:17.228832 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 19:05:17.229013 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 19:05:17.232312 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.232586 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:17.232776 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 19:05:17.236182 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 19:05:17.237630 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 19:05:17.238154 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 19:05:17.242449 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.242707 (MainThread): On master: BEGIN
2021-11-11 19:05:17.242886 (MainThread): Opening a new connection, currently in state init
2021-11-11 19:05:17.246218 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.246487 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.246670 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 19:05:17.258446 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 19:05:17.260003 (MainThread): On master: ROLLBACK
2021-11-11 19:05:17.260537 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.260741 (MainThread): On master: BEGIN
2021-11-11 19:05:17.261384 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.261803 (MainThread): On master: COMMIT
2021-11-11 19:05:17.262164 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.262519 (MainThread): On master: COMMIT
2021-11-11 19:05:17.263162 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:17.263553 (MainThread): On master: Close
2021-11-11 19:05:17.264222 (MainThread): 20:05:17 | Concurrency: 2 threads (target='dev')
2021-11-11 19:05:17.264649 (MainThread): 20:05:17 | 
2021-11-11 19:05:17.268231 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 19:05:17.268555 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 19:05:17.268941 (Thread-1): 20:05:17 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 19:05:17.269279 (Thread-2): 20:05:17 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 19:05:17.270001 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:17.271062 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.271385 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 19:05:17.271645 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 19:05:17.273109 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:17.274368 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:17.274851 (Thread-1): finished collecting timing info
2021-11-11 19:05:17.280258 (Thread-2): finished collecting timing info
2021-11-11 19:05:17.312230 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:17.311057 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:17.312907 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:17.313095 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 19:05:17.313269 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:17.313669 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.313940 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 19:05:17.314112 (Thread-2): Opening a new connection, currently in state init
2021-11-11 19:05:17.316580 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.316921 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:17.317146 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.317393 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 19:05:17.317588 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.317880 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 19:05:17.318078 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 19:05:17.318327 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 19:05:17.318928 (Thread-1): finished collecting timing info
2021-11-11 19:05:17.319371 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 19:05:17.321847 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 19:05:17.329284 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.329598 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 19:05:17.320073 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:17.330675 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1464eca2-88ea-4242-bf52-74ff513066d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118c79d130>]}
2021-11-11 19:05:17.330869 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:17.331315 (Thread-1): 20:05:17 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.06s]
2021-11-11 19:05:17.333279 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.333539 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 19:05:17.333758 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 19:05:17.333989 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 19:05:17.334593 (Thread-1): 20:05:17 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 19:05:17.334866 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:17.335249 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:17.343058 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:17.343281 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 19:05:17.343482 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.344741 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:17.344966 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:17.345458 (Thread-1): finished collecting timing info
2021-11-11 19:05:17.348809 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:17.349042 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:17.353780 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:17.354059 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 19:05:17.354299 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:17.354526 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 19:05:17.354838 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:17.356935 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 19:05:17.358185 (Thread-2): finished collecting timing info
2021-11-11 19:05:17.358489 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 19:05:17.359102 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1464eca2-88ea-4242-bf52-74ff513066d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e81ed60>]}
2021-11-11 19:05:17.359331 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.359864 (Thread-2): 20:05:17 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.09s]
2021-11-11 19:05:17.360049 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:17.360322 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 19:05:17.360502 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from awesomeinc.product_category as pc, awesomeinc.product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 19:05:17.361277 (Thread-1): Postgres error: relation "awesomeinc.product_category" does not exist
LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
              ^

2021-11-11 19:05:17.361509 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 19:05:17.361992 (Thread-1): finished collecting timing info
2021-11-11 19:05:17.362223 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 19:05:17.362652 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product_category" does not exist
  LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "awesomeinc.product_category" does not exist
LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product_category" does not exist
  LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
                ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 19:05:17.363383 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1464eca2-88ea-4242-bf52-74ff513066d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118c784a00>]}
2021-11-11 19:05:17.364280 (Thread-1): 20:05:17 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.03s]
2021-11-11 19:05:17.364768 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 19:05:17.366065 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:17.366328 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.366505 (MainThread): On master: BEGIN
2021-11-11 19:05:17.366679 (MainThread): Opening a new connection, currently in state closed
2021-11-11 19:05:17.369772 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:17.370055 (MainThread): On master: COMMIT
2021-11-11 19:05:17.370289 (MainThread): Using postgres connection "master".
2021-11-11 19:05:17.370453 (MainThread): On master: COMMIT
2021-11-11 19:05:17.370773 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:17.370988 (MainThread): On master: Close
2021-11-11 19:05:17.371435 (MainThread): 20:05:17 | 
2021-11-11 19:05:17.371653 (MainThread): 20:05:17 | Finished running 3 view models in 0.17s.
2021-11-11 19:05:17.371841 (MainThread): Connection 'master' was properly closed.
2021-11-11 19:05:17.372002 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 19:05:17.372157 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 19:05:17.376341 (MainThread): 
2021-11-11 19:05:17.376564 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 19:05:17.376760 (MainThread): 
2021-11-11 19:05:17.376973 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 19:05:17.377159 (MainThread):   syntax error at or near ")"
2021-11-11 19:05:17.377345 (MainThread):   LINE 5:   );
2021-11-11 19:05:17.377514 (MainThread):             ^
2021-11-11 19:05:17.377679 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:17.377879 (MainThread): 
2021-11-11 19:05:17.378063 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 19:05:17.378240 (MainThread):   relation "awesomeinc.product_category" does not exist
2021-11-11 19:05:17.378409 (MainThread):   LINE 8:  from awesomeinc.product_category as pc, awesomeinc.product ...
2021-11-11 19:05:17.378577 (MainThread):                 ^
2021-11-11 19:05:17.378743 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 19:05:17.378919 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 19:05:17.379208 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118c79aa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e984e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f118e984c10>]}
2021-11-11 19:05:17.379532 (MainThread): Flushing usage events
2021-11-11 19:05:34.032213 (MainThread): Running with dbt=0.21.0
2021-11-11 19:05:34.095840 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 19:05:34.096712 (MainThread): Tracking: tracking
2021-11-11 19:05:34.121437 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f4495580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f29abe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f29abaf0>]}
2021-11-11 19:05:34.131774 (MainThread): Partial parsing not enabled
2021-11-11 19:05:34.139125 (MainThread): Parsing macros/adapters.sql
2021-11-11 19:05:34.161945 (MainThread): Parsing macros/relations.sql
2021-11-11 19:05:34.163338 (MainThread): Parsing macros/catalog.sql
2021-11-11 19:05:34.165521 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 19:05:34.167163 (MainThread): Parsing macros/core.sql
2021-11-11 19:05:34.170757 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 19:05:34.172156 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 19:05:34.174364 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 19:05:34.175996 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 19:05:34.177201 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 19:05:34.232005 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 19:05:34.238814 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 19:05:34.248751 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 19:05:34.272837 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 19:05:34.276884 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 19:05:34.284955 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 19:05:34.286909 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 19:05:34.318676 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 19:05:34.335510 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 19:05:34.348922 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 19:05:34.356067 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 19:05:34.365879 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 19:05:34.384705 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 19:05:34.386436 (MainThread): Parsing macros/etc/query.sql
2021-11-11 19:05:34.387446 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 19:05:34.395673 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 19:05:34.397299 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 19:05:34.398786 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 19:05:34.400255 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 19:05:34.402051 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 19:05:34.571729 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.582801 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:34.585631 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:34.633203 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 19:05:34.638293 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd7c812a0-291f-4ec0-8b52-72e39cf90100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f28fe670>]}
2021-11-11 19:05:34.643415 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 19:05:34.643773 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd7c812a0-291f-4ec0-8b52-72e39cf90100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f28ebeb0>]}
2021-11-11 19:05:34.644087 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 19:05:34.645530 (MainThread): 
2021-11-11 19:05:34.646021 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:34.647432 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 19:05:34.657235 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 19:05:34.657475 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 19:05:34.657651 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 19:05:34.667043 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 19:05:34.668539 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 19:05:34.669853 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 19:05:34.675783 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:34.676020 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 19:05:34.676195 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 19:05:34.679442 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.679728 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:34.679941 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 19:05:34.683141 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 19:05:34.684568 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 19:05:34.684976 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 19:05:34.689200 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.689411 (MainThread): On master: BEGIN
2021-11-11 19:05:34.689586 (MainThread): Opening a new connection, currently in state init
2021-11-11 19:05:34.692778 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.693140 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.693320 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 19:05:34.704644 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 19:05:34.706013 (MainThread): On master: ROLLBACK
2021-11-11 19:05:34.706533 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.706723 (MainThread): On master: BEGIN
2021-11-11 19:05:34.707477 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.707688 (MainThread): On master: COMMIT
2021-11-11 19:05:34.707862 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.708021 (MainThread): On master: COMMIT
2021-11-11 19:05:34.708517 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:34.708726 (MainThread): On master: Close
2021-11-11 19:05:34.709210 (MainThread): 20:05:34 | Concurrency: 2 threads (target='dev')
2021-11-11 19:05:34.709596 (MainThread): 20:05:34 | 
2021-11-11 19:05:34.712360 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 19:05:34.712753 (Thread-1): 20:05:34 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 19:05:34.713025 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 19:05:34.713427 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:34.713764 (Thread-2): 20:05:34 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 19:05:34.714094 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 19:05:34.715839 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:34.716505 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.716966 (Thread-1): finished collecting timing info
2021-11-11 19:05:34.717220 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 19:05:34.723910 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:34.743041 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:34.743507 (Thread-2): finished collecting timing info
2021-11-11 19:05:34.743758 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:34.746011 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:34.746269 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 19:05:34.746621 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:34.747033 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.747250 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 19:05:34.747544 (Thread-2): Opening a new connection, currently in state init
2021-11-11 19:05:34.749775 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.750067 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:34.750371 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 19:05:34.750603 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.750880 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.751175 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 19:05:34.751415 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 19:05:34.751752 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 19:05:34.752346 (Thread-1): finished collecting timing info
2021-11-11 19:05:34.752586 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 19:05:34.753018 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:34.754837 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7c812a0-291f-4ec0-8b52-72e39cf90100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f2a48790>]}
2021-11-11 19:05:34.755125 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 19:05:34.755654 (Thread-1): 20:05:34 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.04s]
2021-11-11 19:05:34.762380 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.762691 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 19:05:34.762922 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 19:05:34.763200 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 19:05:34.763652 (Thread-1): 20:05:34 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 19:05:34.764024 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:34.764224 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 19:05:34.765525 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:34.765911 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:34.768675 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.768996 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 19:05:34.769440 (Thread-1): finished collecting timing info
2021-11-11 19:05:34.774459 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:34.774742 (Thread-2): SQL status: ALTER TABLE in 0.01 seconds
2021-11-11 19:05:34.780300 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:34.780531 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 19:05:34.780727 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:34.783043 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:34.783301 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.783478 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:34.784507 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.784767 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:34.784951 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, awesomeinc.product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 19:05:34.786115 (Thread-1): Postgres error: relation "awesomeinc.product" does not exist
LINE 8:  from product_category as pc, awesomeinc.product as p
                                      ^

2021-11-11 19:05:34.786382 (Thread-1): On model.IBA_challenge.product_category: ROLLBACK
2021-11-11 19:05:34.786836 (Thread-1): finished collecting timing info
2021-11-11 19:05:34.787121 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 19:05:34.788171 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:34.793807 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:34.794132 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 19:05:34.787803 (Thread-1): Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product" does not exist
  LINE 8:  from product_category as pc, awesomeinc.product as p
                                        ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "awesomeinc.product" does not exist
LINE 8:  from product_category as pc, awesomeinc.product as p
                                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model product_category (models/product_category.sql)
  relation "awesomeinc.product" does not exist
  LINE 8:  from product_category as pc, awesomeinc.product as p
                                        ^
  compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 19:05:34.794761 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7c812a0-291f-4ec0-8b52-72e39cf90100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f2a44d00>]}
2021-11-11 19:05:34.795263 (Thread-1): 20:05:34 | 3 of 3 ERROR creating view model public.product_category............. [ERROR in 0.03s]
2021-11-11 19:05:34.795495 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 19:05:34.796493 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 19:05:34.797720 (Thread-2): finished collecting timing info
2021-11-11 19:05:34.798093 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 19:05:34.798695 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7c812a0-291f-4ec0-8b52-72e39cf90100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f0062d30>]}
2021-11-11 19:05:34.799196 (Thread-2): 20:05:34 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 19:05:34.799423 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 19:05:34.800588 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:34.800833 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.801031 (MainThread): On master: BEGIN
2021-11-11 19:05:34.801203 (MainThread): Opening a new connection, currently in state closed
2021-11-11 19:05:34.804999 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:34.805330 (MainThread): On master: COMMIT
2021-11-11 19:05:34.805508 (MainThread): Using postgres connection "master".
2021-11-11 19:05:34.805675 (MainThread): On master: COMMIT
2021-11-11 19:05:34.806099 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:34.806310 (MainThread): On master: Close
2021-11-11 19:05:34.806758 (MainThread): 20:05:34 | 
2021-11-11 19:05:34.806980 (MainThread): 20:05:34 | Finished running 3 view models in 0.16s.
2021-11-11 19:05:34.807217 (MainThread): Connection 'master' was properly closed.
2021-11-11 19:05:34.807384 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 19:05:34.807541 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 19:05:34.811886 (MainThread): 
2021-11-11 19:05:34.812141 (MainThread): Completed with 2 errors and 0 warnings:
2021-11-11 19:05:34.812338 (MainThread): 
2021-11-11 19:05:34.812526 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 19:05:34.812703 (MainThread):   syntax error at or near ")"
2021-11-11 19:05:34.812871 (MainThread):   LINE 5:   );
2021-11-11 19:05:34.813036 (MainThread):             ^
2021-11-11 19:05:34.813200 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:34.813370 (MainThread): 
2021-11-11 19:05:34.813551 (MainThread): Database Error in model product_category (models/product_category.sql)
2021-11-11 19:05:34.813739 (MainThread):   relation "awesomeinc.product" does not exist
2021-11-11 19:05:34.813910 (MainThread):   LINE 8:  from product_category as pc, awesomeinc.product as p
2021-11-11 19:05:34.814074 (MainThread):                                         ^
2021-11-11 19:05:34.814235 (MainThread):   compiled SQL at target/run/IBA_challenge/models/product_category.sql
2021-11-11 19:05:34.814410 (MainThread): 
Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
2021-11-11 19:05:34.814652 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f4c42f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f4c422e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4f4c42430>]}
2021-11-11 19:05:34.814926 (MainThread): Flushing usage events
2021-11-11 19:05:46.149551 (MainThread): Running with dbt=0.21.0
2021-11-11 19:05:46.211329 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 19:05:46.212099 (MainThread): Tracking: tracking
2021-11-11 19:05:46.236300 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f9cb0730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f81c2ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f81c2eb0>]}
2021-11-11 19:05:46.246916 (MainThread): Partial parsing not enabled
2021-11-11 19:05:46.255549 (MainThread): Parsing macros/adapters.sql
2021-11-11 19:05:46.282743 (MainThread): Parsing macros/relations.sql
2021-11-11 19:05:46.284477 (MainThread): Parsing macros/catalog.sql
2021-11-11 19:05:46.286930 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 19:05:46.288763 (MainThread): Parsing macros/core.sql
2021-11-11 19:05:46.292706 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 19:05:46.295728 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 19:05:46.300546 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 19:05:46.304650 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 19:05:46.307522 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 19:05:46.370922 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 19:05:46.377478 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 19:05:46.386960 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 19:05:46.408857 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 19:05:46.412654 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 19:05:46.419475 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 19:05:46.421140 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 19:05:46.450529 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 19:05:46.467027 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 19:05:46.480492 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 19:05:46.487628 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 19:05:46.497350 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 19:05:46.515982 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 19:05:46.517710 (MainThread): Parsing macros/etc/query.sql
2021-11-11 19:05:46.518692 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 19:05:46.526808 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 19:05:46.528385 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 19:05:46.529860 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 19:05:46.531335 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 19:05:46.533091 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 19:05:46.702850 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.714070 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:46.716910 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.764382 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 19:05:46.769595 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d01ea58-8102-4dbd-9bad-7ef074ee9c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f8116760>]}
2021-11-11 19:05:46.774798 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 19:05:46.775275 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d01ea58-8102-4dbd-9bad-7ef074ee9c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f80eaaf0>]}
2021-11-11 19:05:46.775727 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 19:05:46.777142 (MainThread): 
2021-11-11 19:05:46.777591 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:46.779066 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 19:05:46.788860 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 19:05:46.789112 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 19:05:46.789290 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 19:05:46.794084 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 19:05:46.795664 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 19:05:46.797900 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 19:05:46.803630 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:46.803847 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 19:05:46.804019 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 19:05:46.807151 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.807424 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 19:05:46.807602 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 19:05:46.810676 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 19:05:46.812042 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 19:05:46.812427 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 19:05:46.817451 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.817695 (MainThread): On master: BEGIN
2021-11-11 19:05:46.817891 (MainThread): Opening a new connection, currently in state init
2021-11-11 19:05:46.821363 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.821640 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.821841 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 19:05:46.832917 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2021-11-11 19:05:46.834313 (MainThread): On master: ROLLBACK
2021-11-11 19:05:46.834763 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.835003 (MainThread): On master: BEGIN
2021-11-11 19:05:46.835529 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.835757 (MainThread): On master: COMMIT
2021-11-11 19:05:46.835978 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.836156 (MainThread): On master: COMMIT
2021-11-11 19:05:46.836524 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:46.836726 (MainThread): On master: Close
2021-11-11 19:05:46.837151 (MainThread): 20:05:46 | Concurrency: 2 threads (target='dev')
2021-11-11 19:05:46.837410 (MainThread): 20:05:46 | 
2021-11-11 19:05:46.840448 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 19:05:46.840757 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 19:05:46.841297 (Thread-1): 20:05:46 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 19:05:46.841639 (Thread-2): 20:05:46 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 19:05:46.842218 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:46.842640 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.842915 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 19:05:46.843164 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 19:05:46.844613 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:46.846005 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:46.846533 (Thread-2): finished collecting timing info
2021-11-11 19:05:46.862628 (Thread-1): finished collecting timing info
2021-11-11 19:05:46.874115 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 19:05:46.876534 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 19:05:46.877055 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.877234 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 19:05:46.877404 (Thread-2): Opening a new connection, currently in state init
2021-11-11 19:05:46.877619 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:46.878049 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 19:05:46.878230 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:46.881650 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.881935 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.882161 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.882367 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 19:05:46.882565 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 19:05:46.882809 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.
  );

2021-11-11 19:05:46.883285 (Thread-1): Postgres error: syntax error at or near ")"
LINE 5:   );
          ^

2021-11-11 19:05:46.883505 (Thread-1): On model.IBA_challenge.best_market: ROLLBACK
2021-11-11 19:05:46.883910 (Thread-1): finished collecting timing info
2021-11-11 19:05:46.884143 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 19:05:46.885887 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 19:05:46.892309 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.884562 (Thread-1): Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near ")"
LINE 5:   );
          ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_market (models/best_market_region.sql)
  syntax error at or near ")"
  LINE 5:   );
            ^
  compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:46.892662 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 19:05:46.892987 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d01ea58-8102-4dbd-9bad-7ef074ee9c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f587e130>]}
2021-11-11 19:05:46.893433 (Thread-1): 20:05:46 | 1 of 3 ERROR creating view model public.best_market.................. [ERROR in 0.05s]
2021-11-11 19:05:46.893646 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 19:05:46.893857 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:46.894066 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 19:05:46.896418 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.897014 (Thread-1): 20:05:46 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 19:05:46.897303 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 19:05:46.897896 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.898229 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 19:05:46.900320 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:46.900582 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:46.907278 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:46.907497 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.907699 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 19:05:46.907920 (Thread-1): finished collecting timing info
2021-11-11 19:05:46.911176 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 19:05:46.911573 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.911748 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 19:05:46.911918 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 19:05:46.915404 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.915686 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.915873 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

final as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from final
  );

2021-11-11 19:05:46.916927 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-11 19:05:46.921767 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 19:05:46.922028 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 19:05:46.922249 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 19:05:46.924309 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.924528 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 19:05:46.924756 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category" rename to "product_category__dbt_backup"
2021-11-11 19:05:46.926017 (Thread-2): finished collecting timing info
2021-11-11 19:05:46.926459 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 19:05:46.926952 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d01ea58-8102-4dbd-9bad-7ef074ee9c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f80d5af0>]}
2021-11-11 19:05:46.927159 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:46.927679 (Thread-2): 20:05:46 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.08s]
2021-11-11 19:05:46.930224 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.930555 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 19:05:46.930742 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category__dbt_tmp" rename to "product_category"
2021-11-11 19:05:46.931799 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 19:05:46.932929 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 19:05:46.933114 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.933278 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 19:05:46.934948 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:46.936509 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 19:05:46.936736 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
drop table if exists "awesomeinc"."public"."product_category__dbt_backup" cascade
2021-11-11 19:05:46.940516 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2021-11-11 19:05:46.941783 (Thread-1): finished collecting timing info
2021-11-11 19:05:46.942021 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 19:05:46.942443 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d01ea58-8102-4dbd-9bad-7ef074ee9c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f58732b0>]}
2021-11-11 19:05:46.942826 (Thread-1): 20:05:46 | 3 of 3 OK created view model public.product_category................. [CREATE VIEW in 0.04s]
2021-11-11 19:05:46.943126 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 19:05:46.944286 (MainThread): Acquiring new postgres connection "master".
2021-11-11 19:05:46.944535 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.944706 (MainThread): On master: BEGIN
2021-11-11 19:05:46.944872 (MainThread): Opening a new connection, currently in state closed
2021-11-11 19:05:46.948808 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 19:05:46.949112 (MainThread): On master: COMMIT
2021-11-11 19:05:46.949295 (MainThread): Using postgres connection "master".
2021-11-11 19:05:46.949461 (MainThread): On master: COMMIT
2021-11-11 19:05:46.949746 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 19:05:46.949944 (MainThread): On master: Close
2021-11-11 19:05:46.950397 (MainThread): 20:05:46 | 
2021-11-11 19:05:46.950608 (MainThread): 20:05:46 | Finished running 3 view models in 0.17s.
2021-11-11 19:05:46.950829 (MainThread): Connection 'master' was properly closed.
2021-11-11 19:05:46.951010 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 19:05:46.951165 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 19:05:46.955333 (MainThread): 
2021-11-11 19:05:46.955576 (MainThread): Completed with 1 error and 0 warnings:
2021-11-11 19:05:46.955862 (MainThread): 
2021-11-11 19:05:46.956174 (MainThread): Database Error in model best_market (models/best_market_region.sql)
2021-11-11 19:05:46.956449 (MainThread):   syntax error at or near ")"
2021-11-11 19:05:46.956732 (MainThread):   LINE 5:   );
2021-11-11 19:05:46.956980 (MainThread):             ^
2021-11-11 19:05:46.957173 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_market_region.sql
2021-11-11 19:05:46.957381 (MainThread): 
Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
2021-11-11 19:05:46.957655 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f9f644f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f9f64940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f58f9cc0220>]}
2021-11-11 19:05:46.957992 (MainThread): Flushing usage events
2021-11-11 20:41:32.795369 (MainThread): Running with dbt=0.21.0
2021-11-11 20:41:32.892220 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 20:41:32.893319 (MainThread): Tracking: tracking
2021-11-11 20:41:32.931593 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabd486220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabb997dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabb997790>]}
2021-11-11 20:41:32.948858 (MainThread): Partial parsing not enabled
2021-11-11 20:41:32.960198 (MainThread): Parsing macros/adapters.sql
2021-11-11 20:41:32.997048 (MainThread): Parsing macros/relations.sql
2021-11-11 20:41:32.999133 (MainThread): Parsing macros/catalog.sql
2021-11-11 20:41:33.002329 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 20:41:33.004553 (MainThread): Parsing macros/core.sql
2021-11-11 20:41:33.009935 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 20:41:33.012001 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 20:41:33.015323 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 20:41:33.017609 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 20:41:33.019373 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 20:41:33.101541 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 20:41:33.110966 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 20:41:33.124506 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 20:41:33.157835 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 20:41:33.163463 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 20:41:33.173327 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 20:41:33.176032 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 20:41:33.227910 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 20:41:33.259674 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 20:41:33.292382 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 20:41:33.305570 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 20:41:33.326103 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 20:41:33.413155 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 20:41:33.420233 (MainThread): Parsing macros/etc/query.sql
2021-11-11 20:41:33.423167 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 20:41:33.448717 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 20:41:33.454334 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 20:41:33.457968 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 20:41:33.460834 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 20:41:33.463963 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 20:41:33.726823 (MainThread): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:33.742992 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:33.747033 (MainThread): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:33.806087 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 20:41:33.812509 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bebe2ea5-80d5-4572-a5f3-34c4a0fc9c4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabb8eb610>]}
2021-11-11 20:41:33.819915 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 20:41:33.821014 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bebe2ea5-80d5-4572-a5f3-34c4a0fc9c4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabba16790>]}
2021-11-11 20:41:33.821424 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 20:41:33.823226 (MainThread): 
2021-11-11 20:41:33.823810 (MainThread): Acquiring new postgres connection "master".
2021-11-11 20:41:33.825055 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 20:41:33.839801 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 20:41:33.840152 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 20:41:33.840370 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 20:41:33.846885 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 20:41:33.848686 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 20:41:33.850750 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 20:41:33.858925 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 20:41:33.859522 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 20:41:33.859976 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 20:41:33.866718 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:33.867198 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 20:41:33.867529 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 20:41:33.874162 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 20:41:33.876476 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 20:41:33.877082 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 20:41:33.884025 (MainThread): Using postgres connection "master".
2021-11-11 20:41:33.884466 (MainThread): On master: BEGIN
2021-11-11 20:41:33.884875 (MainThread): Opening a new connection, currently in state init
2021-11-11 20:41:33.891197 (MainThread): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:33.891687 (MainThread): Using postgres connection "master".
2021-11-11 20:41:33.891972 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 20:41:33.910831 (MainThread): SQL status: SELECT 1 in 0.02 seconds
2021-11-11 20:41:33.912590 (MainThread): On master: ROLLBACK
2021-11-11 20:41:33.913275 (MainThread): Using postgres connection "master".
2021-11-11 20:41:33.913529 (MainThread): On master: BEGIN
2021-11-11 20:41:33.914534 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 20:41:33.914887 (MainThread): On master: COMMIT
2021-11-11 20:41:33.915155 (MainThread): Using postgres connection "master".
2021-11-11 20:41:33.915405 (MainThread): On master: COMMIT
2021-11-11 20:41:33.916101 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 20:41:33.916432 (MainThread): On master: Close
2021-11-11 20:41:33.917065 (MainThread): 21:41:33 | Concurrency: 2 threads (target='dev')
2021-11-11 20:41:33.917430 (MainThread): 21:41:33 | 
2021-11-11 20:41:33.922173 (Thread-1): Began running node model.IBA_challenge.best_market
2021-11-11 20:41:33.922773 (Thread-2): Began running node model.IBA_challenge.num_installations
2021-11-11 20:41:33.923585 (Thread-1): 21:41:33 | 1 of 3 START view model public.best_market........................... [RUN]
2021-11-11 20:41:33.924095 (Thread-2): 21:41:33 | 2 of 3 START view model public.num_installations..................... [RUN]
2021-11-11 20:41:33.924872 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:33.925894 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:33.926389 (Thread-1): Compiling model.IBA_challenge.best_market
2021-11-11 20:41:33.926791 (Thread-2): Compiling model.IBA_challenge.num_installations
2021-11-11 20:41:33.930117 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market"
2021-11-11 20:41:33.932276 (Thread-2): Writing injected SQL for node "model.IBA_challenge.num_installations"
2021-11-11 20:41:33.933035 (Thread-1): finished collecting timing info
2021-11-11 20:41:33.938545 (Thread-2): finished collecting timing info
2021-11-11 20:41:34.010701 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market"
2021-11-11 20:41:34.011342 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.num_installations"
2021-11-11 20:41:34.012350 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:34.012842 (Thread-1): On model.IBA_challenge.best_market: BEGIN
2021-11-11 20:41:34.013419 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.013989 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 20:41:34.014453 (Thread-2): On model.IBA_challenge.num_installations: BEGIN
2021-11-11 20:41:34.015328 (Thread-2): Opening a new connection, currently in state init
2021-11-11 20:41:34.020033 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:34.020610 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:34.021047 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */

  create view "awesomeinc"."public"."best_market__dbt_tmp" as (
    --Which region of the world is our best market.

with customer_expenses as(
	select cu.id, sum(cast(p.price as float)) as expenses
	from customer as cu, installation as ins, product as p
	where cu.id = ins.customer_id and p.id = ins.product_id
	group by cu.id
),

country_expenses as (
	select cu.country_id, sum(ce.expenses) as expenses
	from customer as cu, customer_expenses as ce
	where cu.id = ce.id
	group by cu.country_id
),

region_expenses as (
	select co.region, sum(ce.expenses) as expenses
	from country as co, country_expenses as ce
	where co.id = ce.country_id
	group by co.region
),

best_region as (
	select region, expenses
	from region_expenses
	where expenses = (select max(expenses) from region_expenses)
)

select * from best_region
  );

2021-11-11 20:41:34.021503 (Thread-2): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:34.021940 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.022323 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */

  create view "awesomeinc"."public"."num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 20:41:34.027423 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 20:41:34.034178 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 20:41:34.037951 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.041156 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:34.041683 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations" rename to "num_installations__dbt_backup"
2021-11-11 20:41:34.042120 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */
alter table "awesomeinc"."public"."best_market__dbt_tmp" rename to "best_market"
2021-11-11 20:41:34.043985 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 20:41:34.044733 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 20:41:34.052174 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.060990 (Thread-1): On model.IBA_challenge.best_market: COMMIT
2021-11-11 20:41:34.061376 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
alter table "awesomeinc"."public"."num_installations__dbt_tmp" rename to "num_installations"
2021-11-11 20:41:34.061918 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:34.062681 (Thread-1): On model.IBA_challenge.best_market: COMMIT
2021-11-11 20:41:34.063839 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 20:41:34.066915 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 20:41:34.067389 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 20:41:34.067792 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.076428 (Thread-1): Using postgres connection "model.IBA_challenge.best_market".
2021-11-11 20:41:34.076783 (Thread-2): On model.IBA_challenge.num_installations: COMMIT
2021-11-11 20:41:34.077256 (Thread-1): On model.IBA_challenge.best_market: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market"} */
drop view if exists "awesomeinc"."public"."best_market__dbt_backup" cascade
2021-11-11 20:41:34.078379 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 20:41:34.080304 (Thread-1): finished collecting timing info
2021-11-11 20:41:34.080616 (Thread-1): On model.IBA_challenge.best_market: Close
2021-11-11 20:41:34.081531 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebe2ea5-80d5-4572-a5f3-34c4a0fc9c4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabb8aba00>]}
2021-11-11 20:41:34.081972 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 20:41:34.082790 (Thread-1): 21:41:34 | 1 of 3 OK created view model public.best_market...................... [CREATE VIEW in 0.16s]
2021-11-11 20:41:34.085045 (Thread-2): Using postgres connection "model.IBA_challenge.num_installations".
2021-11-11 20:41:34.085625 (Thread-1): Finished running node model.IBA_challenge.best_market
2021-11-11 20:41:34.086068 (Thread-2): On model.IBA_challenge.num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.num_installations"} */
drop view if exists "awesomeinc"."public"."num_installations__dbt_backup" cascade
2021-11-11 20:41:34.086569 (Thread-1): Began running node model.IBA_challenge.product_category
2021-11-11 20:41:34.087554 (Thread-1): 21:41:34 | 3 of 3 START view model public.product_category...................... [RUN]
2021-11-11 20:41:34.088162 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.088438 (Thread-1): Compiling model.IBA_challenge.product_category
2021-11-11 20:41:34.090145 (Thread-1): Writing injected SQL for node "model.IBA_challenge.product_category"
2021-11-11 20:41:34.090514 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 20:41:34.092080 (Thread-2): finished collecting timing info
2021-11-11 20:41:34.092388 (Thread-2): On model.IBA_challenge.num_installations: Close
2021-11-11 20:41:34.093177 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebe2ea5-80d5-4572-a5f3-34c4a0fc9c4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabdc34460>]}
2021-11-11 20:41:34.093535 (Thread-1): finished collecting timing info
2021-11-11 20:41:34.094311 (Thread-2): 21:41:34 | 2 of 3 OK created view model public.num_installations................ [CREATE VIEW in 0.17s]
2021-11-11 20:41:34.097408 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.product_category"
2021-11-11 20:41:34.098138 (Thread-2): Finished running node model.IBA_challenge.num_installations
2021-11-11 20:41:34.098859 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.100058 (Thread-1): On model.IBA_challenge.product_category: BEGIN
2021-11-11 20:41:34.100431 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 20:41:34.106752 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:34.107235 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.107607 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */

  create view "awesomeinc"."public"."product_category__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

best_product_category_revenue as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from best_product_category_revenue
  );

2021-11-11 20:41:34.113144 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 20:41:34.116470 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.116877 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category" rename to "product_category__dbt_backup"
2021-11-11 20:41:34.118102 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 20:41:34.120797 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.121231 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
alter table "awesomeinc"."public"."product_category__dbt_tmp" rename to "product_category"
2021-11-11 20:41:34.122433 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 20:41:34.124188 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 20:41:34.124455 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.124682 (Thread-1): On model.IBA_challenge.product_category: COMMIT
2021-11-11 20:41:34.126496 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 20:41:34.128772 (Thread-1): Using postgres connection "model.IBA_challenge.product_category".
2021-11-11 20:41:34.129277 (Thread-1): On model.IBA_challenge.product_category: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.product_category"} */
drop table if exists "awesomeinc"."public"."product_category__dbt_backup" cascade
2021-11-11 20:41:34.133949 (Thread-1): SQL status: DROP TABLE in 0.00 seconds
2021-11-11 20:41:34.135544 (Thread-1): finished collecting timing info
2021-11-11 20:41:34.135857 (Thread-1): On model.IBA_challenge.product_category: Close
2021-11-11 20:41:34.136569 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebe2ea5-80d5-4572-a5f3-34c4a0fc9c4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcab9036d30>]}
2021-11-11 20:41:34.137088 (Thread-1): 21:41:34 | 3 of 3 OK created view model public.product_category................. [CREATE VIEW in 0.05s]
2021-11-11 20:41:34.137584 (Thread-1): Finished running node model.IBA_challenge.product_category
2021-11-11 20:41:34.139283 (MainThread): Acquiring new postgres connection "master".
2021-11-11 20:41:34.139580 (MainThread): Using postgres connection "master".
2021-11-11 20:41:34.139835 (MainThread): On master: BEGIN
2021-11-11 20:41:34.140065 (MainThread): Opening a new connection, currently in state closed
2021-11-11 20:41:34.145656 (MainThread): SQL status: BEGIN in 0.01 seconds
2021-11-11 20:41:34.146285 (MainThread): On master: COMMIT
2021-11-11 20:41:34.146597 (MainThread): Using postgres connection "master".
2021-11-11 20:41:34.146930 (MainThread): On master: COMMIT
2021-11-11 20:41:34.148453 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 20:41:34.149144 (MainThread): On master: Close
2021-11-11 20:41:34.149904 (MainThread): 21:41:34 | 
2021-11-11 20:41:34.150287 (MainThread): 21:41:34 | Finished running 3 view models in 0.33s.
2021-11-11 20:41:34.150655 (MainThread): Connection 'master' was properly closed.
2021-11-11 20:41:34.150910 (MainThread): Connection 'model.IBA_challenge.product_category' was properly closed.
2021-11-11 20:41:34.151163 (MainThread): Connection 'model.IBA_challenge.num_installations' was properly closed.
2021-11-11 20:41:34.157834 (MainThread): 
2021-11-11 20:41:34.158188 (MainThread): Completed successfully
2021-11-11 20:41:34.158503 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2021-11-11 20:41:34.158885 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabdcdf190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabd74a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcabd74a7f0>]}
2021-11-11 20:41:34.159359 (MainThread): Flushing usage events
2021-11-11 21:03:28.177141 (MainThread): Running with dbt=0.21.0
2021-11-11 21:03:28.249460 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 21:03:28.250651 (MainThread): Tracking: tracking
2021-11-11 21:03:28.284389 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7095832580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7093d47df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7093d47dc0>]}
2021-11-11 21:03:28.299693 (MainThread): Partial parsing not enabled
2021-11-11 21:03:28.309099 (MainThread): Parsing macros/adapters.sql
2021-11-11 21:03:28.334188 (MainThread): Parsing macros/relations.sql
2021-11-11 21:03:28.335560 (MainThread): Parsing macros/catalog.sql
2021-11-11 21:03:28.337832 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 21:03:28.339578 (MainThread): Parsing macros/core.sql
2021-11-11 21:03:28.343279 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 21:03:28.344810 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 21:03:28.347271 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 21:03:28.348936 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 21:03:28.350350 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 21:03:28.408521 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 21:03:28.415701 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 21:03:28.425282 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 21:03:28.448355 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 21:03:28.452396 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 21:03:28.461132 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 21:03:28.463210 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 21:03:28.495373 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 21:03:28.513271 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 21:03:28.527556 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 21:03:28.535108 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 21:03:28.545629 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 21:03:28.565522 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 21:03:28.567272 (MainThread): Parsing macros/etc/query.sql
2021-11-11 21:03:28.568264 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 21:03:28.576687 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 21:03:28.578436 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 21:03:28.579945 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 21:03:28.581444 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 21:03:28.583240 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 21:03:28.761546 (MainThread): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:28.774449 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:03:28.777375 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:28.823805 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 21:03:28.828857 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99637632-859c-470a-a3cc-e2365edb8fc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7093c9a670>]}
2021-11-11 21:03:28.833981 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 21:03:28.834359 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99637632-859c-470a-a3cc-e2365edb8fc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7093c8ff10>]}
2021-11-11 21:03:28.834863 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 21:03:28.836919 (MainThread): 
2021-11-11 21:03:28.838242 (MainThread): Acquiring new postgres connection "master".
2021-11-11 21:03:28.839783 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 21:03:28.850853 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 21:03:28.851079 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 21:03:28.851257 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 21:03:28.859154 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 21:03:28.861162 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 21:03:28.863158 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 21:03:28.870620 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 21:03:28.870837 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 21:03:28.871011 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 21:03:28.875591 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:03:28.876036 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 21:03:28.876385 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 21:03:28.881010 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-11 21:03:28.882982 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 21:03:28.883616 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 21:03:28.889995 (MainThread): Using postgres connection "master".
2021-11-11 21:03:28.890323 (MainThread): On master: BEGIN
2021-11-11 21:03:28.890574 (MainThread): Opening a new connection, currently in state init
2021-11-11 21:03:28.895404 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:03:28.895763 (MainThread): Using postgres connection "master".
2021-11-11 21:03:28.896051 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 21:03:28.911260 (MainThread): SQL status: SELECT 5 in 0.01 seconds
2021-11-11 21:03:28.913443 (MainThread): On master: ROLLBACK
2021-11-11 21:03:28.914125 (MainThread): Using postgres connection "master".
2021-11-11 21:03:28.914360 (MainThread): On master: BEGIN
2021-11-11 21:03:28.915280 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:03:28.915636 (MainThread): On master: COMMIT
2021-11-11 21:03:28.915851 (MainThread): Using postgres connection "master".
2021-11-11 21:03:28.916041 (MainThread): On master: COMMIT
2021-11-11 21:03:28.916587 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:03:28.916845 (MainThread): On master: Close
2021-11-11 21:03:28.917473 (MainThread): 22:03:28 | Concurrency: 2 threads (target='dev')
2021-11-11 21:03:28.917781 (MainThread): 22:03:28 | 
2021-11-11 21:03:28.920290 (Thread-1): Began running node model.IBA_challenge.best_market_region
2021-11-11 21:03:28.920699 (Thread-2): Began running node model.IBA_challenge.best_product_category_revenue
2021-11-11 21:03:28.921171 (Thread-1): 22:03:28 | 1 of 3 START view model public.best_market_region.................... [RUN]
2021-11-11 21:03:28.921618 (Thread-2): 22:03:28 | 2 of 3 START view model public.best_product_category_revenue......... [RUN]
2021-11-11 21:03:28.922339 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:28.922887 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:03:28.923190 (Thread-1): Compiling model.IBA_challenge.best_market_region
2021-11-11 21:03:28.923490 (Thread-2): Compiling model.IBA_challenge.best_product_category_revenue
2021-11-11 21:03:28.924965 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market_region"
2021-11-11 21:03:28.926360 (Thread-2): Writing injected SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-11 21:03:28.926996 (Thread-1): finished collecting timing info
2021-11-11 21:03:28.932486 (Thread-2): finished collecting timing info
2021-11-11 21:03:28.983038 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-11 21:03:28.984798 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market_region"
2021-11-11 21:03:28.985553 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:28.985946 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:03:28.986265 (Thread-1): On model.IBA_challenge.best_market_region: BEGIN
2021-11-11 21:03:28.986599 (Thread-2): On model.IBA_challenge.best_product_category_revenue: BEGIN
2021-11-11 21:03:28.986931 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 21:03:28.987249 (Thread-2): Opening a new connection, currently in state init
2021-11-11 21:03:28.992190 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:03:28.992573 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 21:03:28.992841 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:03:28.993106 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:28.993367 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */

  create view "awesomeinc"."public"."best_product_category_revenue__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

best_product_category_revenue as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from best_product_category_revenue
  );

2021-11-11 21:03:28.993620 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */

  create view "awesomeinc"."public"."best_market_region__dbt_tmp" as (
    --Which region of the world is our best market.

with customer_expenses as(
	select cu.id, sum(cast(p.price as float)) as expenses
	from customer as cu, installation as ins, product as p
	where cu.id = ins.customer_id and p.id = ins.product_id
	group by cu.id
),

country_expenses as (
	select cu.country_id, sum(ce.expenses) as expenses
	from customer as cu, customer_expenses as ce
	where cu.id = ce.id
	group by cu.country_id
),

region_expenses as (
	select co.region, sum(ce.expenses) as expenses
	from country as co, country_expenses as ce
	where co.id = ce.country_id
	group by co.region
),

best_region as (
	select region, expenses
	from region_expenses
	where expenses = (select max(expenses) from region_expenses)
)

select * from best_region
  );

2021-11-11 21:03:28.994762 (Thread-2): Postgres error: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^

2021-11-11 21:03:28.995232 (Thread-2): On model.IBA_challenge.best_product_category_revenue: ROLLBACK
2021-11-11 21:03:28.996014 (Thread-2): finished collecting timing info
2021-11-11 21:03:28.996511 (Thread-2): On model.IBA_challenge.best_product_category_revenue: Close
2021-11-11 21:03:28.997280 (Thread-2): Database Error in model best_product_category_revenue (models/best_product_category_revenue.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/best_product_category_revenue.sql
Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 56, in exception_handler
    yield
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "product_category" does not exist
LINE 8:  from product_category as pc, product as p
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 68, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/home/felipe/anaconda3/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/felipe/dbt-env/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 67, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model best_product_category_revenue (models/best_product_category_revenue.sql)
  relation "product_category" does not exist
  LINE 8:  from product_category as pc, product as p
                ^
  compiled SQL at target/run/IBA_challenge/models/best_product_category_revenue.sql
2021-11-11 21:03:28.999820 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 21:03:29.000284 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99637632-859c-470a-a3cc-e2365edb8fc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70913fba60>]}
2021-11-11 21:03:29.008331 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:29.008987 (Thread-2): 22:03:29 | 2 of 3 ERROR creating view model public.best_product_category_revenue [ERROR in 0.08s]
2021-11-11 21:03:29.009314 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
alter table "awesomeinc"."public"."best_market_region__dbt_tmp" rename to "best_market_region"
2021-11-11 21:03:29.009748 (Thread-2): Finished running node model.IBA_challenge.best_product_category_revenue
2021-11-11 21:03:29.010272 (Thread-2): Began running node model.IBA_challenge.monthly_num_installations
2021-11-11 21:03:29.010692 (Thread-2): 22:03:29 | 3 of 3 START view model public.monthly_num_installations............. [RUN]
2021-11-11 21:03:29.011456 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.011739 (Thread-2): Compiling model.IBA_challenge.monthly_num_installations
2021-11-11 21:03:29.013431 (Thread-2): Writing injected SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-11 21:03:29.013810 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:03:29.023484 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-11 21:03:29.024080 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:29.024345 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-11 21:03:29.024644 (Thread-2): finished collecting timing info
2021-11-11 21:03:29.029254 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-11 21:03:29.029669 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:03:29.035876 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:03:29.036386 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.036678 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
drop view if exists "awesomeinc"."public"."best_market_region__dbt_backup" cascade
2021-11-11 21:03:29.037011 (Thread-2): On model.IBA_challenge.monthly_num_installations: BEGIN
2021-11-11 21:03:29.037436 (Thread-2): Opening a new connection, currently in state closed
2021-11-11 21:03:29.037990 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 21:03:29.040198 (Thread-1): finished collecting timing info
2021-11-11 21:03:29.040806 (Thread-1): On model.IBA_challenge.best_market_region: Close
2021-11-11 21:03:29.042436 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99637632-859c-470a-a3cc-e2365edb8fc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7093c62640>]}
2021-11-11 21:03:29.043243 (Thread-1): 22:03:29 | 1 of 3 OK created view model public.best_market_region............... [CREATE VIEW in 0.12s]
2021-11-11 21:03:29.043796 (Thread-1): Finished running node model.IBA_challenge.best_market_region
2021-11-11 21:03:29.044369 (Thread-2): SQL status: BEGIN in 0.01 seconds
2021-11-11 21:03:29.044749 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.045058 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */

  create view "awesomeinc"."public"."monthly_num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 21:03:29.049573 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 21:03:29.053276 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.053706 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
alter table "awesomeinc"."public"."monthly_num_installations__dbt_tmp" rename to "monthly_num_installations"
2021-11-11 21:03:29.054893 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:03:29.056936 (Thread-2): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-11 21:03:29.057278 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.057594 (Thread-2): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-11 21:03:29.059595 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:03:29.062304 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:03:29.062682 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
drop view if exists "awesomeinc"."public"."monthly_num_installations__dbt_backup" cascade
2021-11-11 21:03:29.063636 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 21:03:29.065572 (Thread-2): finished collecting timing info
2021-11-11 21:03:29.066003 (Thread-2): On model.IBA_challenge.monthly_num_installations: Close
2021-11-11 21:03:29.066714 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99637632-859c-470a-a3cc-e2365edb8fc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70914057f0>]}
2021-11-11 21:03:29.067402 (Thread-2): 22:03:29 | 3 of 3 OK created view model public.monthly_num_installations........ [CREATE VIEW in 0.06s]
2021-11-11 21:03:29.067831 (Thread-2): Finished running node model.IBA_challenge.monthly_num_installations
2021-11-11 21:03:29.070159 (MainThread): Acquiring new postgres connection "master".
2021-11-11 21:03:29.070625 (MainThread): Using postgres connection "master".
2021-11-11 21:03:29.070933 (MainThread): On master: BEGIN
2021-11-11 21:03:29.071263 (MainThread): Opening a new connection, currently in state closed
2021-11-11 21:03:29.077340 (MainThread): SQL status: BEGIN in 0.01 seconds
2021-11-11 21:03:29.077898 (MainThread): On master: COMMIT
2021-11-11 21:03:29.078216 (MainThread): Using postgres connection "master".
2021-11-11 21:03:29.078538 (MainThread): On master: COMMIT
2021-11-11 21:03:29.079249 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:03:29.079625 (MainThread): On master: Close
2021-11-11 21:03:29.080373 (MainThread): 22:03:29 | 
2021-11-11 21:03:29.080756 (MainThread): 22:03:29 | Finished running 3 view models in 0.24s.
2021-11-11 21:03:29.081130 (MainThread): Connection 'master' was properly closed.
2021-11-11 21:03:29.081418 (MainThread): Connection 'model.IBA_challenge.best_market_region' was properly closed.
2021-11-11 21:03:29.081716 (MainThread): Connection 'model.IBA_challenge.monthly_num_installations' was properly closed.
2021-11-11 21:03:29.088937 (MainThread): 
2021-11-11 21:03:29.089354 (MainThread): Completed with 1 error and 0 warnings:
2021-11-11 21:03:29.089714 (MainThread): 
2021-11-11 21:03:29.090065 (MainThread): Database Error in model best_product_category_revenue (models/best_product_category_revenue.sql)
2021-11-11 21:03:29.090394 (MainThread):   relation "product_category" does not exist
2021-11-11 21:03:29.090706 (MainThread):   LINE 8:  from product_category as pc, product as p
2021-11-11 21:03:29.091013 (MainThread):                 ^
2021-11-11 21:03:29.091316 (MainThread):   compiled SQL at target/run/IBA_challenge/models/best_product_category_revenue.sql
2021-11-11 21:03:29.091642 (MainThread): 
Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
2021-11-11 21:03:29.092068 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7091407a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70960a7a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70914057f0>]}
2021-11-11 21:03:29.092526 (MainThread): Flushing usage events
2021-11-11 21:04:26.973631 (MainThread): Running with dbt=0.21.0
2021-11-11 21:04:27.047816 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-11 21:04:27.048810 (MainThread): Tracking: tracking
2021-11-11 21:04:27.083697 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0ab4997f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a99ade20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a99ad7f0>]}
2021-11-11 21:04:27.099056 (MainThread): Partial parsing not enabled
2021-11-11 21:04:27.107638 (MainThread): Parsing macros/adapters.sql
2021-11-11 21:04:27.136462 (MainThread): Parsing macros/relations.sql
2021-11-11 21:04:27.137995 (MainThread): Parsing macros/catalog.sql
2021-11-11 21:04:27.140348 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-11 21:04:27.142351 (MainThread): Parsing macros/core.sql
2021-11-11 21:04:27.146441 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-11 21:04:27.148007 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-11 21:04:27.150572 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-11 21:04:27.152915 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-11 21:04:27.154731 (MainThread): Parsing macros/adapters/common.sql
2021-11-11 21:04:27.217394 (MainThread): Parsing macros/materializations/test.sql
2021-11-11 21:04:27.226489 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-11 21:04:27.240335 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-11 21:04:27.272698 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-11 21:04:27.278258 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-11 21:04:27.287655 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-11 21:04:27.291129 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-11 21:04:27.332159 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-11 21:04:27.351031 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-11 21:04:27.366348 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-11 21:04:27.374617 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-11 21:04:27.385950 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-11 21:04:27.406660 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-11 21:04:27.408413 (MainThread): Parsing macros/etc/query.sql
2021-11-11 21:04:27.409414 (MainThread): Parsing macros/etc/datetime.sql
2021-11-11 21:04:27.418679 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-11 21:04:27.420314 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-11 21:04:27.422169 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-11 21:04:27.423783 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-11 21:04:27.425678 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-11 21:04:27.620217 (MainThread): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.632553 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.635863 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.683570 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-11 21:04:27.688780 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9fb74de4-41a9-437c-a892-793608650225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a9901670>]}
2021-11-11 21:04:27.694249 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-11 21:04:27.694681 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9fb74de4-41a9-437c-a892-793608650225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a9a2d2b0>]}
2021-11-11 21:04:27.695116 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-11 21:04:27.697766 (MainThread): 
2021-11-11 21:04:27.699051 (MainThread): Acquiring new postgres connection "master".
2021-11-11 21:04:27.700279 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-11 21:04:27.711285 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-11 21:04:27.711632 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-11 21:04:27.711887 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-11 21:04:27.720208 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.01 seconds
2021-11-11 21:04:27.722234 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-11 21:04:27.724099 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-11 21:04:27.732576 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 21:04:27.732898 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-11 21:04:27.733169 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-11 21:04:27.737824 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:04:27.738217 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-11 21:04:27.738505 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-11 21:04:27.743148 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2021-11-11 21:04:27.745242 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-11 21:04:27.745887 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-11 21:04:27.752141 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.752466 (MainThread): On master: BEGIN
2021-11-11 21:04:27.752732 (MainThread): Opening a new connection, currently in state init
2021-11-11 21:04:27.757484 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:04:27.757893 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.758162 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-11 21:04:27.783195 (MainThread): SQL status: SELECT 10 in 0.02 seconds
2021-11-11 21:04:27.785146 (MainThread): On master: ROLLBACK
2021-11-11 21:04:27.785746 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.786004 (MainThread): On master: BEGIN
2021-11-11 21:04:27.787111 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:04:27.787447 (MainThread): On master: COMMIT
2021-11-11 21:04:27.787744 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.787943 (MainThread): On master: COMMIT
2021-11-11 21:04:27.788545 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:04:27.788806 (MainThread): On master: Close
2021-11-11 21:04:27.789415 (MainThread): 22:04:27 | Concurrency: 2 threads (target='dev')
2021-11-11 21:04:27.789968 (MainThread): 22:04:27 | 
2021-11-11 21:04:27.792923 (Thread-1): Began running node model.IBA_challenge.best_market_region
2021-11-11 21:04:27.793309 (Thread-2): Began running node model.IBA_challenge.best_product_category_revenue
2021-11-11 21:04:27.793852 (Thread-1): 22:04:27 | 1 of 3 START view model public.best_market_region.................... [RUN]
2021-11-11 21:04:27.794302 (Thread-2): 22:04:27 | 2 of 3 START view model public.best_product_category_revenue......... [RUN]
2021-11-11 21:04:27.794976 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.795567 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.795901 (Thread-1): Compiling model.IBA_challenge.best_market_region
2021-11-11 21:04:27.796309 (Thread-2): Compiling model.IBA_challenge.best_product_category_revenue
2021-11-11 21:04:27.798136 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market_region"
2021-11-11 21:04:27.799519 (Thread-2): Writing injected SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-11 21:04:27.800083 (Thread-1): finished collecting timing info
2021-11-11 21:04:27.810712 (Thread-2): finished collecting timing info
2021-11-11 21:04:27.866394 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-11 21:04:27.867515 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market_region"
2021-11-11 21:04:27.868111 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.868453 (Thread-2): On model.IBA_challenge.best_product_category_revenue: BEGIN
2021-11-11 21:04:27.868702 (Thread-2): Opening a new connection, currently in state init
2021-11-11 21:04:27.868954 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.869318 (Thread-1): On model.IBA_challenge.best_market_region: BEGIN
2021-11-11 21:04:27.869612 (Thread-1): Opening a new connection, currently in state closed
2021-11-11 21:04:27.874405 (Thread-2): SQL status: BEGIN in 0.01 seconds
2021-11-11 21:04:27.874941 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.875311 (Thread-1): SQL status: BEGIN in 0.01 seconds
2021-11-11 21:04:27.875696 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */

  create view "awesomeinc"."public"."best_product_category_revenue__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

best_product_category_revenue as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from best_product_category_revenue
  );

2021-11-11 21:04:27.876057 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.876477 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */

  create view "awesomeinc"."public"."best_market_region__dbt_tmp" as (
    --Which region of the world is our best market.

with customer_expenses as(
	select cu.id, sum(cast(p.price as float)) as expenses
	from customer as cu, installation as ins, product as p
	where cu.id = ins.customer_id and p.id = ins.product_id
	group by cu.id
),

country_expenses as (
	select cu.country_id, sum(ce.expenses) as expenses
	from customer as cu, customer_expenses as ce
	where cu.id = ce.id
	group by cu.country_id
),

region_expenses as (
	select co.region, sum(ce.expenses) as expenses
	from country as co, country_expenses as ce
	where co.id = ce.country_id
	group by co.region
),

best_region as (
	select region, expenses
	from region_expenses
	where expenses = (select max(expenses) from region_expenses)
)

select * from best_region
  );

2021-11-11 21:04:27.882845 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 21:04:27.883254 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-11 21:04:27.893623 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.897464 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.897936 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */
alter table "awesomeinc"."public"."best_product_category_revenue__dbt_tmp" rename to "best_product_category_revenue"
2021-11-11 21:04:27.898371 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
alter table "awesomeinc"."public"."best_market_region" rename to "best_market_region__dbt_backup"
2021-11-11 21:04:27.899916 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:04:27.905432 (Thread-1): SQL status: ALTER TABLE in 0.01 seconds
2021-11-11 21:04:27.910679 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.916836 (Thread-2): On model.IBA_challenge.best_product_category_revenue: COMMIT
2021-11-11 21:04:27.917291 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
alter table "awesomeinc"."public"."best_market_region__dbt_tmp" rename to "best_market_region"
2021-11-11 21:04:27.917760 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.918336 (Thread-2): On model.IBA_challenge.best_product_category_revenue: COMMIT
2021-11-11 21:04:27.919281 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:04:27.921189 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-11 21:04:27.921546 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.921885 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-11 21:04:27.922246 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:04:27.930213 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-11 21:04:27.930579 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */
drop view if exists "awesomeinc"."public"."best_product_category_revenue__dbt_backup" cascade
2021-11-11 21:04:27.931052 (Thread-1): SQL status: COMMIT in 0.01 seconds
2021-11-11 21:04:27.933574 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-11 21:04:27.933954 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
drop view if exists "awesomeinc"."public"."best_market_region__dbt_backup" cascade
2021-11-11 21:04:27.934338 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 21:04:27.936232 (Thread-2): finished collecting timing info
2021-11-11 21:04:27.936631 (Thread-2): On model.IBA_challenge.best_product_category_revenue: Close
2021-11-11 21:04:27.937397 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fb74de4-41a9-437c-a892-793608650225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a9a30310>]}
2021-11-11 21:04:27.938110 (Thread-2): 22:04:27 | 2 of 3 OK created view model public.best_product_category_revenue.... [CREATE VIEW in 0.14s]
2021-11-11 21:04:27.938524 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 21:04:27.940395 (Thread-1): finished collecting timing info
2021-11-11 21:04:27.940792 (Thread-1): On model.IBA_challenge.best_market_region: Close
2021-11-11 21:04:27.941230 (Thread-2): Finished running node model.IBA_challenge.best_product_category_revenue
2021-11-11 21:04:27.941958 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fb74de4-41a9-437c-a892-793608650225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a8063e20>]}
2021-11-11 21:04:27.942438 (Thread-2): Began running node model.IBA_challenge.monthly_num_installations
2021-11-11 21:04:27.943474 (Thread-1): 22:04:27 | 1 of 3 OK created view model public.best_market_region............... [CREATE VIEW in 0.15s]
2021-11-11 21:04:27.944021 (Thread-2): 22:04:27 | 3 of 3 START view model public.monthly_num_installations............. [RUN]
2021-11-11 21:04:27.944699 (Thread-1): Finished running node model.IBA_challenge.best_market_region
2021-11-11 21:04:27.945737 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.946226 (Thread-2): Compiling model.IBA_challenge.monthly_num_installations
2021-11-11 21:04:27.948244 (Thread-2): Writing injected SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-11 21:04:27.948825 (Thread-2): finished collecting timing info
2021-11-11 21:04:27.952908 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-11 21:04:27.954373 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.954751 (Thread-2): On model.IBA_challenge.monthly_num_installations: BEGIN
2021-11-11 21:04:27.955057 (Thread-2): Opening a new connection, currently in state closed
2021-11-11 21:04:27.959989 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:04:27.960544 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.960830 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */

  create view "awesomeinc"."public"."monthly_num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-11 21:04:27.964957 (Thread-2): SQL status: CREATE VIEW in 0.00 seconds
2021-11-11 21:04:27.968564 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.968993 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
alter table "awesomeinc"."public"."monthly_num_installations" rename to "monthly_num_installations__dbt_backup"
2021-11-11 21:04:27.970916 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:04:27.973952 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.974250 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
alter table "awesomeinc"."public"."monthly_num_installations__dbt_tmp" rename to "monthly_num_installations"
2021-11-11 21:04:27.975223 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-11 21:04:27.977023 (Thread-2): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-11 21:04:27.977304 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.977546 (Thread-2): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-11 21:04:27.979563 (Thread-2): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:04:27.981451 (Thread-2): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-11 21:04:27.981763 (Thread-2): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
drop view if exists "awesomeinc"."public"."monthly_num_installations__dbt_backup" cascade
2021-11-11 21:04:27.984508 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-11 21:04:27.986081 (Thread-2): finished collecting timing info
2021-11-11 21:04:27.986415 (Thread-2): On model.IBA_challenge.monthly_num_installations: Close
2021-11-11 21:04:27.987003 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fb74de4-41a9-437c-a892-793608650225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a8018040>]}
2021-11-11 21:04:27.987549 (Thread-2): 22:04:27 | 3 of 3 OK created view model public.monthly_num_installations........ [CREATE VIEW in 0.04s]
2021-11-11 21:04:27.987938 (Thread-2): Finished running node model.IBA_challenge.monthly_num_installations
2021-11-11 21:04:27.989801 (MainThread): Acquiring new postgres connection "master".
2021-11-11 21:04:27.990143 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.990398 (MainThread): On master: BEGIN
2021-11-11 21:04:27.990641 (MainThread): Opening a new connection, currently in state closed
2021-11-11 21:04:27.995602 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-11 21:04:27.995987 (MainThread): On master: COMMIT
2021-11-11 21:04:27.996252 (MainThread): Using postgres connection "master".
2021-11-11 21:04:27.996497 (MainThread): On master: COMMIT
2021-11-11 21:04:27.997063 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-11 21:04:27.997411 (MainThread): On master: Close
2021-11-11 21:04:27.998283 (MainThread): 22:04:27 | 
2021-11-11 21:04:27.998745 (MainThread): 22:04:27 | Finished running 3 view models in 0.30s.
2021-11-11 21:04:27.999254 (MainThread): Connection 'master' was properly closed.
2021-11-11 21:04:27.999597 (MainThread): Connection 'model.IBA_challenge.best_market_region' was properly closed.
2021-11-11 21:04:27.999954 (MainThread): Connection 'model.IBA_challenge.monthly_num_installations' was properly closed.
2021-11-11 21:04:28.006751 (MainThread): 
2021-11-11 21:04:28.007134 (MainThread): Completed successfully
2021-11-11 21:04:28.007435 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2021-11-11 21:04:28.007786 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0a99706d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0abd026d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0abd02af0>]}
2021-11-11 21:04:28.008167 (MainThread): Flushing usage events
2021-11-12 17:13:04.296436 (MainThread): Running with dbt=0.21.0
2021-11-12 17:13:04.366479 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-11-12 17:13:04.367582 (MainThread): Tracking: tracking
2021-11-12 17:13:04.378844 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d26835d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2832fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2684d1f0>]}
2021-11-12 17:13:04.390945 (MainThread): Partial parsing not enabled
2021-11-12 17:13:04.400632 (MainThread): Parsing macros/adapters.sql
2021-11-12 17:13:04.427289 (MainThread): Parsing macros/relations.sql
2021-11-12 17:13:04.428897 (MainThread): Parsing macros/catalog.sql
2021-11-12 17:13:04.431438 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-12 17:13:04.433405 (MainThread): Parsing macros/core.sql
2021-11-12 17:13:04.437662 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-12 17:13:04.439303 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-12 17:13:04.441933 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-12 17:13:04.443892 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-12 17:13:04.445371 (MainThread): Parsing macros/adapters/common.sql
2021-11-12 17:13:04.508755 (MainThread): Parsing macros/materializations/test.sql
2021-11-12 17:13:04.516414 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-12 17:13:04.527619 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-12 17:13:04.553217 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-12 17:13:04.557617 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-12 17:13:04.565270 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-12 17:13:04.567148 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-12 17:13:04.600570 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-12 17:13:04.619935 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-12 17:13:04.638725 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-12 17:13:04.646812 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-12 17:13:04.658139 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-12 17:13:04.679449 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-12 17:13:04.681427 (MainThread): Parsing macros/etc/query.sql
2021-11-12 17:13:04.682551 (MainThread): Parsing macros/etc/datetime.sql
2021-11-12 17:13:04.691825 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-12 17:13:04.693649 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-12 17:13:04.695359 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-12 17:13:04.697068 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-12 17:13:04.699132 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-12 17:13:04.895866 (MainThread): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:04.908909 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:04.912279 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:04.966006 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-12 17:13:04.970957 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '25fc9ffa-4c28-43ee-aac6-d421880f03dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2678ba30>]}
2021-11-12 17:13:04.976626 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-12 17:13:04.977033 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25fc9ffa-4c28-43ee-aac6-d421880f03dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d26766d90>]}
2021-11-12 17:13:04.977494 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-12 17:13:04.979138 (MainThread): 
2021-11-12 17:13:04.979737 (MainThread): Acquiring new postgres connection "master".
2021-11-12 17:13:04.981677 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_awesomeinc".
2021-11-12 17:13:04.991713 (ThreadPoolExecutor-0_0): Using postgres connection "list_awesomeinc".
2021-11-12 17:13:04.991946 (ThreadPoolExecutor-0_0): On list_awesomeinc: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc"} */

    select distinct nspname from pg_namespace
  
2021-11-12 17:13:04.992148 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-11-12 17:13:04.996837 (ThreadPoolExecutor-0_0): SQL status: SELECT 6 in 0.00 seconds
2021-11-12 17:13:04.998455 (ThreadPoolExecutor-0_0): On list_awesomeinc: Close
2021-11-12 17:13:05.001461 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_awesomeinc_public".
2021-11-12 17:13:05.007381 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-12 17:13:05.007595 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: BEGIN
2021-11-12 17:13:05.007769 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-11-12 17:13:05.011457 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.011719 (ThreadPoolExecutor-1_0): Using postgres connection "list_awesomeinc_public".
2021-11-12 17:13:05.011892 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "list_awesomeinc_public"} */
select
      'awesomeinc' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'awesomeinc' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
2021-11-12 17:13:05.018251 (ThreadPoolExecutor-1_0): SQL status: SELECT 20 in 0.01 seconds
2021-11-12 17:13:05.019847 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: ROLLBACK
2021-11-12 17:13:05.020350 (ThreadPoolExecutor-1_0): On list_awesomeinc_public: Close
2021-11-12 17:13:05.025006 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.025238 (MainThread): On master: BEGIN
2021-11-12 17:13:05.025427 (MainThread): Opening a new connection, currently in state init
2021-11-12 17:13:05.028966 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.029227 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.029406 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-11-12 17:13:05.209765 (MainThread): SQL status: SELECT 13 in 0.18 seconds
2021-11-12 17:13:05.211541 (MainThread): On master: ROLLBACK
2021-11-12 17:13:05.211928 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.212128 (MainThread): On master: BEGIN
2021-11-12 17:13:05.212719 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.212927 (MainThread): On master: COMMIT
2021-11-12 17:13:05.213100 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.213261 (MainThread): On master: COMMIT
2021-11-12 17:13:05.213610 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-12 17:13:05.213819 (MainThread): On master: Close
2021-11-12 17:13:05.214217 (MainThread): 18:13:05 | Concurrency: 2 threads (target='dev')
2021-11-12 17:13:05.214447 (MainThread): 18:13:05 | 
2021-11-12 17:13:05.216406 (Thread-1): Began running node model.IBA_challenge.best_market_region
2021-11-12 17:13:05.216668 (Thread-2): Began running node model.IBA_challenge.best_product_category_revenue
2021-11-12 17:13:05.217028 (Thread-1): 18:13:05 | 1 of 3 START view model public.best_market_region.................... [RUN]
2021-11-12 17:13:05.217327 (Thread-2): 18:13:05 | 2 of 3 START view model public.best_product_category_revenue......... [RUN]
2021-11-12 17:13:05.217778 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.218363 (Thread-2): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.218591 (Thread-1): Compiling model.IBA_challenge.best_market_region
2021-11-12 17:13:05.218800 (Thread-2): Compiling model.IBA_challenge.best_product_category_revenue
2021-11-12 17:13:05.220123 (Thread-1): Writing injected SQL for node "model.IBA_challenge.best_market_region"
2021-11-12 17:13:05.221382 (Thread-2): Writing injected SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-12 17:13:05.225115 (Thread-2): finished collecting timing info
2021-11-12 17:13:05.225352 (Thread-1): finished collecting timing info
2021-11-12 17:13:05.256478 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.best_market_region"
2021-11-12 17:13:05.255842 (Thread-2): Writing runtime SQL for node "model.IBA_challenge.best_product_category_revenue"
2021-11-12 17:13:05.257225 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.257461 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.257632 (Thread-1): On model.IBA_challenge.best_market_region: BEGIN
2021-11-12 17:13:05.257844 (Thread-2): On model.IBA_challenge.best_product_category_revenue: BEGIN
2021-11-12 17:13:05.258046 (Thread-1): Opening a new connection, currently in state closed
2021-11-12 17:13:05.258235 (Thread-2): Opening a new connection, currently in state init
2021-11-12 17:13:05.261693 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.261962 (Thread-2): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.262236 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.262457 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.262659 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */

  create view "awesomeinc"."public"."best_market_region__dbt_tmp" as (
    --Which region of the world is our best market.

with customer_expenses as(
	select cu.id, sum(cast(p.price as float)) as expenses
	from customer as cu, installation as ins, product as p
	where cu.id = ins.customer_id and p.id = ins.product_id
	group by cu.id
),

country_expenses as (
	select cu.country_id, sum(ce.expenses) as expenses
	from customer as cu, customer_expenses as ce
	where cu.id = ce.id
	group by cu.country_id
),

region_expenses as (
	select co.region, sum(ce.expenses) as expenses
	from country as co, country_expenses as ce
	where co.id = ce.country_id
	group by co.region
),

best_region as (
	select region, expenses
	from region_expenses
	where expenses = (select max(expenses) from region_expenses)
)

select * from best_region
  );

2021-11-12 17:13:05.262855 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */

  create view "awesomeinc"."public"."best_product_category_revenue__dbt_tmp" as (
    --We would also like to see which product category brings us more revenues

with product_info as (
	select p.id, pc.name as prod_cat_name, p.reference, p.name as prod_name, p.price
	from product_category as pc, product as p
	where p.category_id = pc.id
	order by cast(p.price as float) asc
),

installations_per_product as (
	select product_id, count(product_id) as sells
	from installation
	group by product_id
),

total_sells_per_product as (
	select pi.prod_cat_name, ipp.sells, pi.price, ipp.sells*cast(pi.price as float) as revenue
	from product_info as pi, installations_per_product as ipp
	where pi.id = ipp.product_id
),

best_product_category_revenue as (
	select prod_cat_name, revenue
	from total_sells_per_product
	where revenue = (select max(revenue) from total_sells_per_product)
)

select * from best_product_category_revenue
  );

2021-11-12 17:13:05.272566 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2021-11-12 17:13:05.272845 (Thread-2): SQL status: CREATE VIEW in 0.01 seconds
2021-11-12 17:13:05.279167 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.281370 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.281618 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
alter table "awesomeinc"."public"."best_market_region" rename to "best_market_region__dbt_backup"
2021-11-12 17:13:05.281823 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */
alter table "awesomeinc"."public"."best_product_category_revenue" rename to "best_product_category_revenue__dbt_backup"
2021-11-12 17:13:05.282942 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.283153 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.285228 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.288420 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.288655 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */
alter table "awesomeinc"."public"."best_product_category_revenue__dbt_tmp" rename to "best_product_category_revenue"
2021-11-12 17:13:05.288858 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
alter table "awesomeinc"."public"."best_market_region__dbt_tmp" rename to "best_market_region"
2021-11-12 17:13:05.289766 (Thread-2): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.289974 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.296510 (Thread-2): On model.IBA_challenge.best_product_category_revenue: COMMIT
2021-11-12 17:13:05.297559 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-12 17:13:05.297780 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.297990 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.298180 (Thread-2): On model.IBA_challenge.best_product_category_revenue: COMMIT
2021-11-12 17:13:05.298369 (Thread-1): On model.IBA_challenge.best_market_region: COMMIT
2021-11-12 17:13:05.300377 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-12 17:13:05.305247 (Thread-1): Using postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:05.305483 (Thread-1): On model.IBA_challenge.best_market_region: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_market_region"} */
drop view if exists "awesomeinc"."public"."best_market_region__dbt_backup" cascade
2021-11-12 17:13:05.305712 (Thread-2): SQL status: COMMIT in 0.01 seconds
2021-11-12 17:13:05.307146 (Thread-2): Using postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:05.307347 (Thread-2): On model.IBA_challenge.best_product_category_revenue: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.best_product_category_revenue"} */
drop view if exists "awesomeinc"."public"."best_product_category_revenue__dbt_backup" cascade
2021-11-12 17:13:05.308781 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-12 17:13:05.310153 (Thread-1): finished collecting timing info
2021-11-12 17:13:05.310413 (Thread-1): On model.IBA_challenge.best_market_region: Close
2021-11-12 17:13:05.310621 (Thread-2): SQL status: DROP VIEW in 0.00 seconds
2021-11-12 17:13:05.311071 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25fc9ffa-4c28-43ee-aac6-d421880f03dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d268bb340>]}
2021-11-12 17:13:05.312752 (Thread-2): finished collecting timing info
2021-11-12 17:13:05.313464 (Thread-1): 18:13:05 | 1 of 3 OK created view model public.best_market_region............... [CREATE VIEW in 0.09s]
2021-11-12 17:13:05.313760 (Thread-2): On model.IBA_challenge.best_product_category_revenue: Close
2021-11-12 17:13:05.314163 (Thread-1): Finished running node model.IBA_challenge.best_market_region
2021-11-12 17:13:05.314540 (Thread-1): Began running node model.IBA_challenge.monthly_num_installations
2021-11-12 17:13:05.315097 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25fc9ffa-4c28-43ee-aac6-d421880f03dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d25f506d0>]}
2021-11-12 17:13:05.315539 (Thread-1): 18:13:05 | 3 of 3 START view model public.monthly_num_installations............. [RUN]
2021-11-12 17:13:05.316049 (Thread-2): 18:13:05 | 2 of 3 OK created view model public.best_product_category_revenue.... [CREATE VIEW in 0.10s]
2021-11-12 17:13:05.316445 (Thread-1): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.316647 (Thread-2): Finished running node model.IBA_challenge.best_product_category_revenue
2021-11-12 17:13:05.316879 (Thread-1): Compiling model.IBA_challenge.monthly_num_installations
2021-11-12 17:13:05.318281 (Thread-1): Writing injected SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-12 17:13:05.318844 (Thread-1): finished collecting timing info
2021-11-12 17:13:05.321268 (Thread-1): Writing runtime SQL for node "model.IBA_challenge.monthly_num_installations"
2021-11-12 17:13:05.321881 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.322056 (Thread-1): On model.IBA_challenge.monthly_num_installations: BEGIN
2021-11-12 17:13:05.322225 (Thread-1): Opening a new connection, currently in state closed
2021-11-12 17:13:05.325849 (Thread-1): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.326143 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.326327 (Thread-1): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */

  create view "awesomeinc"."public"."monthly_num_installations__dbt_tmp" as (
    --We would like to report on the number of installations
--that the company is doing every month in order to see if the business is growing.

with num_installations as (
    select
        extract(year from installation_date) "Year",
        extract(month from installation_date) "Month",
        count(*)
    from
        installation
    group by
        extract(year from installation_date),
        extract(month from installation_date)
    order by 1, 2
)

select * from num_installations
  );

2021-11-12 17:13:05.330937 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2021-11-12 17:13:05.333449 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.333678 (Thread-1): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
alter table "awesomeinc"."public"."monthly_num_installations" rename to "monthly_num_installations__dbt_backup"
2021-11-12 17:13:05.334365 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.336317 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.336511 (Thread-1): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
alter table "awesomeinc"."public"."monthly_num_installations__dbt_tmp" rename to "monthly_num_installations"
2021-11-12 17:13:05.337195 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2021-11-12 17:13:05.338295 (Thread-1): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-12 17:13:05.338486 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.338649 (Thread-1): On model.IBA_challenge.monthly_num_installations: COMMIT
2021-11-12 17:13:05.340140 (Thread-1): SQL status: COMMIT in 0.00 seconds
2021-11-12 17:13:05.341729 (Thread-1): Using postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:05.342017 (Thread-1): On model.IBA_challenge.monthly_num_installations: /* {"app": "dbt", "dbt_version": "0.21.0", "profile_name": "IBA_challenge", "target_name": "dev", "node_id": "model.IBA_challenge.monthly_num_installations"} */
drop view if exists "awesomeinc"."public"."monthly_num_installations__dbt_backup" cascade
2021-11-12 17:13:05.344483 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2021-11-12 17:13:05.345891 (Thread-1): finished collecting timing info
2021-11-12 17:13:05.346193 (Thread-1): On model.IBA_challenge.monthly_num_installations: Close
2021-11-12 17:13:05.346850 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25fc9ffa-4c28-43ee-aac6-d421880f03dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d267879d0>]}
2021-11-12 17:13:05.347615 (Thread-1): 18:13:05 | 3 of 3 OK created view model public.monthly_num_installations........ [CREATE VIEW in 0.03s]
2021-11-12 17:13:05.348154 (Thread-1): Finished running node model.IBA_challenge.monthly_num_installations
2021-11-12 17:13:05.350145 (MainThread): Acquiring new postgres connection "master".
2021-11-12 17:13:05.350455 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.350631 (MainThread): On master: BEGIN
2021-11-12 17:13:05.350803 (MainThread): Opening a new connection, currently in state closed
2021-11-12 17:13:05.354181 (MainThread): SQL status: BEGIN in 0.00 seconds
2021-11-12 17:13:05.354453 (MainThread): On master: COMMIT
2021-11-12 17:13:05.354620 (MainThread): Using postgres connection "master".
2021-11-12 17:13:05.354776 (MainThread): On master: COMMIT
2021-11-12 17:13:05.355057 (MainThread): SQL status: COMMIT in 0.00 seconds
2021-11-12 17:13:05.355258 (MainThread): On master: Close
2021-11-12 17:13:05.355757 (MainThread): 18:13:05 | 
2021-11-12 17:13:05.355984 (MainThread): 18:13:05 | Finished running 3 view models in 0.38s.
2021-11-12 17:13:05.356245 (MainThread): Connection 'master' was properly closed.
2021-11-12 17:13:05.356407 (MainThread): Connection 'model.IBA_challenge.monthly_num_installations' was properly closed.
2021-11-12 17:13:05.356558 (MainThread): Connection 'model.IBA_challenge.best_product_category_revenue' was properly closed.
2021-11-12 17:13:05.360960 (MainThread): 
2021-11-12 17:13:05.361209 (MainThread): Completed successfully
2021-11-12 17:13:05.361413 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2021-11-12 17:13:05.361679 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d267798e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d28b4ec40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2678bfd0>]}
2021-11-12 17:13:05.361957 (MainThread): Flushing usage events
2021-11-12 17:13:49.190114 (MainThread): Running with dbt=0.21.0
2021-11-12 17:13:49.260523 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.test.TestTask'>, data=False, debug=False, defer=None, exclude=None, fail_fast=False, greedy=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/home/felipe/.dbt', project_dir=None, record_timing_info=None, rpc_method='test', schema=False, select=None, selector_name=None, single_threaded=False, state=None, store_failures=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='test', write_json=True)
2021-11-12 17:13:49.261557 (MainThread): Tracking: tracking
2021-11-12 17:13:49.274279 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65d3ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6783adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65d572b0>]}
2021-11-12 17:13:49.290766 (MainThread): Partial parsing not enabled
2021-11-12 17:13:49.305346 (MainThread): Parsing macros/adapters.sql
2021-11-12 17:13:49.334407 (MainThread): Parsing macros/relations.sql
2021-11-12 17:13:49.335960 (MainThread): Parsing macros/catalog.sql
2021-11-12 17:13:49.338407 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-11-12 17:13:49.340270 (MainThread): Parsing macros/core.sql
2021-11-12 17:13:49.344394 (MainThread): Parsing macros/schema_tests/unique.sql
2021-11-12 17:13:49.345996 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-11-12 17:13:49.348494 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-11-12 17:13:49.350352 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-11-12 17:13:49.351728 (MainThread): Parsing macros/adapters/common.sql
2021-11-12 17:13:49.412682 (MainThread): Parsing macros/materializations/test.sql
2021-11-12 17:13:49.420019 (MainThread): Parsing macros/materializations/helpers.sql
2021-11-12 17:13:49.430722 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-11-12 17:13:49.455558 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-11-12 17:13:49.459924 (MainThread): Parsing macros/materializations/view/view.sql
2021-11-12 17:13:49.467529 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-11-12 17:13:49.469403 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-11-12 17:13:49.502557 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-11-12 17:13:49.521383 (MainThread): Parsing macros/materializations/common/merge.sql
2021-11-12 17:13:49.536410 (MainThread): Parsing macros/materializations/table/table.sql
2021-11-12 17:13:49.544315 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-11-12 17:13:49.555207 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2021-11-12 17:13:49.576264 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-11-12 17:13:49.578232 (MainThread): Parsing macros/etc/query.sql
2021-11-12 17:13:49.579346 (MainThread): Parsing macros/etc/datetime.sql
2021-11-12 17:13:49.588737 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-11-12 17:13:49.590558 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-11-12 17:13:49.592247 (MainThread): Parsing macros/etc/is_incremental.sql
2021-11-12 17:13:49.593927 (MainThread): Parsing macros/etc/where_subquery.sql
2021-11-12 17:13:49.595947 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-11-12 17:13:49.788804 (MainThread): Acquiring new postgres connection "model.IBA_challenge.monthly_num_installations".
2021-11-12 17:13:49.801635 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_product_category_revenue".
2021-11-12 17:13:49.804942 (MainThread): Acquiring new postgres connection "model.IBA_challenge.best_market_region".
2021-11-12 17:13:49.851135 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.IBA_challenge.example

2021-11-12 17:13:49.856117 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8cbd325-f8a7-4a10-8276-b313e8f3a95d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65c9baf0>]}
2021-11-12 17:13:49.861396 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2021-11-12 17:13:49.861858 (MainThread): Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8cbd325-f8a7-4a10-8276-b313e8f3a95d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65c77c10>]}
2021-11-12 17:13:49.862324 (MainThread): Found 3 models, 0 tests, 0 snapshots, 0 analyses, 162 macros, 0 operations, 0 seed files, 0 sources, 0 exposures
2021-11-12 17:13:49.863584 (MainThread): 
WARNING: Nothing to do. Try checking your model configs and model specification args
2021-11-12 17:13:49.867919 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65c77fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65c773d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf65c77550>]}
2021-11-12 17:13:49.868251 (MainThread): Flushing usage events
2021-11-12 17:13:50.394889 (MainThread): Connection 'model.IBA_challenge.best_market_region' was properly closed.
